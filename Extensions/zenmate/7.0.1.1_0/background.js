(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{AytR:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n={production:!0,name:"prod"}},I9DD:function(e,t,s){"use strict";s.r(t);class n{constructor(){}parse(e){const t=e.match(/^(http|https|ftp)?(?:[\:\/]*)([a-z0-9\.-]*)(?:\:([0-9]+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.*))?$/i),s={protocol:"",host:"",port:"",path:"",query:"",fragment:"",domain:"",subdomain:""};if(!t)return s;if(t[1]&&(s.protocol=t[1]),t[2]&&(s.host=t[2]),t[3]&&(s.port=t[3]),t[4]&&(s.path=t[4]),t[5]&&(s.query=t[5]),t[6]&&(s.fragment=t[6]),s.host){const e=t[2].split(".");3==e.length?(s.domain=e[1]+"."+e[2],s.subdomain=e[0]):s.domain=e[0]+"."+e[1]}return s}}class o{constructor(){this.iconStateAssets={signedout:{38:chrome.extension.getURL("icons/standard-38.png"),19:chrome.extension.getURL("icons/standard-19.png")},enabled:{38:chrome.extension.getURL("icons/enabled-38.png"),19:chrome.extension.getURL("icons/enabled-19.png")},disabled:{38:chrome.extension.getURL("icons/disabled-38.png"),19:chrome.extension.getURL("icons/disabled-19.png")}}}setIconImage(e,t=null){const s={path:this.iconStateAssets[e.toLowerCase()],tabId:null};return t&&(s.tabId=t),chrome.browserAction.setIcon(s)}setIconTitle(e){const t={title:"ZenMate"};return e&&(t.title=`${t.title}\n${e}`),chrome.browserAction.setTitle(t)}setIconBadge(e,t=null,s=null){s||(s="#008ace"),chrome.browserAction.setBadgeBackgroundColor({color:s}),chrome.browserAction.setBadgeText({text:e||"",tabId:t},()=>{chrome.runtime.lastError&&console.log("ERROR setBadgeText",chrome.runtime.lastError)})}}var a=s("AytR"),r={dev:s("OtEZ"),prod:s("pcxt"),globals:{connectionCheckDomains:[{url:"http://www.google.com.sg/gen_204",code:204},{url:"http://g.cn/generate_204",code:204},{url:"http://www.thinkdifferent.us",code:200},{url:"http://www.airport.us",code:200},{url:"http://detectportal.firefox.com/success.txt",code:200},{url:"http://captive.apple.com",code:200}],localDomains:["zcdn.de","*.zcdn.de","zeus.pm","*.zeus.pm","d1jr1idae5ms9n.cloudfront.net","local","ip","fritz.box","kabel.box","invalid","intra","intranet","test","example","localhost","onion","i2p","lvh.me","vcap.me","127.0.0.1.xip.io","localtest.me","about:addons","about:newtab","about:preferences","about:config","about:debugging"],blackList:{"jid1-4P0kohSJxU1qGg@jetpack":"hola"},alternativeNodes:[],nodeOverrides:[],ruleOverrides:[{domains:["facebook.com"],hosts:["facebook.net","fbcdn.com","fbcdn.net","fbsbx.com","fb.me","fb.com","fbsbx.com.online-metrix.net","fbstatic-a.akamaihd.net","fbcdn-dragon-a.akamaihd.net"]},{domains:["netflix.com"],hosts:["nflxvideo.net"]},{domains:["bbc.co.uk","bbc.com"],hosts:["bbc.co.uk","bbc.com","vod-dash-uk-live.akamaized.net","vod-thumb-uk-live.akamaized.net"]},{domains:["speedtest.net"],hosts:["ooklaserver.net"]},{domains:["speedtest.xfinity.com"],hosts:["comcast.net"]}],blockedSites:["appnord.xyz"],privateNetworks:["0.0.0.0/8","10.0.0.0/8","127.0.0.0/8","169.254.0.0/16","192.168.0.0/16","172.16.0.0/12","::1","localhost","*.local"]}};class i{constructor(){this.env=a.a.name,this.settings=r[this.env],Object.assign(this.settings,r.globals)}get(e){return this.settings.hasOwnProperty(e)?this.settings[e]:null}}class c{constructor(){this.isChrome="undefined"==typeof browser,this.generateInstallId=()=>{const e=()=>(65536*(1+Math.random())|0).toString(16).substring(1);return`${e()+e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`},this.parseURL=e=>{let t;const s=e.match(/^([^:]+):\/\/([^\/:]*)(?::([\d]+))?(?:(\/[^#]*)(?:#(.*))?)?$/i);return s?{scheme:s[1].toLowerCase(),host:s[2].toLowerCase(),port:s[3],path:s[4]||"/",fragment:s[5],local:(t=s[1].toLowerCase(),!["http","https"].includes(t))}:{}},this.getUTMSourcesFromURL=e=>{let t;const{path:s}=this.parseURL(e),n=/[?&]([^=#]+)=([^&#]*)/g,o=[];for(;t=n.exec(s);)0===t[1].indexOf("utm_")&&o.push(`${t[1]}=${t[2]}`);return o.join(";")},this.concatUnique=(e,t)=>e.concat(t).filter((e,t,s)=>s.indexOf(e)===t),this.parseDate=e=>{const t=new Date(e);if(isNaN(t.getTime())){const[t,s]=e.split(" "),n=t.split("-"),o=s.split(":");return new Date(n[0],n[1]-1,n[2],o[0],o[1],o[2])}return t},this.shuffle=e=>{let t=e.length,s=null,n=null;for(;0!==t;)n=Math.floor(Math.random()*t),t--,s=e[t],e[t]=e[n],e[n]=s;return e},this.chunk=(e,t)=>{t=t<=0?1:t;const s=[];let n=0;const o=e.length;for(;n<o;)s.push(e.slice(n,n+=t));return s},this.hashCode=e=>{let t=0;if("string"!=typeof e&&(e=JSON.stringify(e)),!e||0===e.length)return t;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t&=t;return t},this.hashString=e=>this.hashCode(e).toString()}}const h=new i,l=new c,d={data:{localDomains:h.get("localDomains"),nodeOverrides:h.get("nodeOverrides"),IPv4NotationRE:/^\d+\.\d+\.\d+\.\d+$/g,localIPsRE:/(^127\.)|(^192\.168\.)|(^10\.)|(^172\.1[6-9]\.)|(^172\.2[0-9]\.)|(^172\.3[0-1]\.)/},mergeRuleOverrides(e,t){if(!((e?e.length:void 0)>0))return[];if(!((t?t.length:void 0)>0))return e;for(const s of e)for(const e of t)e.domains.indexOf(s.domain)>-1&&(s.hosts=l.concatUnique(s.hosts||[],e.hosts||[]));return e},nodeLookup:(e,t)=>e[t]||!1,compareHosts(e,t){for(const s of e)if(this.matchWildcardDomain(t,s))return s},compareURLs(e,t){for(const s of e)if(s.test(t))return s},dnsDomainIs:(e,t)=>e.length>=t.length&&e.substring(e.length-t.length)===t,matchWildcardDomain(e,t){const s=e===t,n=e.slice(-t.length)===t,o="."===e[e.lastIndexOf(t)-1];return s||n&&o},matchNodeOverride(e,t){const s=this.data.nodeOverrides.find(s=>s.target_cc===t&&this.compareHosts(s.hosts,e));return!!s&&s.nodes},matchRules(e,t,s){if(e&&e.length){this.data.rulesWithOverrides||(e=this.mergeRuleOverrides(e,h.get("ruleOverrides")));for(let s=0;s<e.length;s++){const n=e[s];if(this.matchWildcardDomain(t,n.domain)||n.hosts&&this.compareHosts(n.hosts,t))return s}}},_getProxyState(e,t,s){if(e=e.toLowerCase(),this.data.IPv4NotationRE.lastIndex=0,this.data.localIPsRE.lastIndex=0,!~t.indexOf(".")&&!~t.indexOf(":"))return"LOCAL";if(this.data.IPv4NotationRE.test(t)&&this.data.localIPsRE.test(t))return"LOCAL";for(const o of this.data.localDomains)if(this.matchWildcardDomain(t,o))return"LOCAL";const n=this.matchRules(s,t,e);return Number.isInteger(n)?s[n].cc:"DEFAULT"}};class u{constructor(){this.urlParser=new n,this.config=new i,this.utils=new c,this.pacScriptRegexp=`    e.data.IPv4NotationRE = ${d.data.IPv4NotationRE.toString()};\n    e.data.localIPsRE = ${d.data.localIPsRE.toString()};    `}serializeEngineToString(e){e=e||d;const t=[];for(const s of Object.keys(e)){const n=e[s].toString();switch(typeof e[s]){case"function":this.checkIfArrowFunction(n)?t.push(`${s}: ${n}`):t.push(`${s}: function ${n}`);break;case"object":t.push(`${s}: ${JSON.stringify(e[s])}`)}}return`{ ${t.join(",")} }`}checkIfArrowFunction(e){return!(!e.includes("=>")||e.includes("{"))||e.startsWith("function")}exportPAC(e,t,s,n){return s=s||[],n=n||[],`      /*ZenMate*/\n      function FindProxyForURL(url, host) {\n\n        var e = ${this.serializeEngineToString(d)};\n        e.data.localDomains = e.data.localDomains.concat(${JSON.stringify(n)});\n        ${this.pacScriptRegexp}\n\n        e.data.defaultLocation = '${e}';\n        e.data.nodeDict = ${JSON.stringify(t)};\n        e.data.rulesWithOverrides = ${JSON.stringify(d.mergeRuleOverrides(s,this.config.get("ruleOverrides")))};\n\n        var res = e._getProxyState(url, host, e.data.rulesWithOverrides);\n        var cc;\n        if (res === 'LOCAL' || res === 'DIRECT' || res === 'OFF') {return 'DIRECT'};\n        if (res === 'DEFAULT') {cc = e.data.defaultLocation} else {cc = res};\n        var override = e.matchNodeOverride(host, cc);\n        if (override) {cc = override};\n\n        return e.nodeLookup(e.data.nodeDict, cc) || 'DIRECT';\n      }      `}getProxyStateByURL(e,t,s){return s=s||[],t=t||this.urlParser.parse(e).host||e,d._getProxyState(e,t,s)}getNodeDictFromLocations(e,t,s=null){e=e.concat(t);const n={};for(const o of e){const e=o.nodes.slice(0,15).map(e=>{const[t,n]=e.dnsname.split(":");return s?`${t}:${n}`:`HTTPS ${t}:${n?n.trim():443}`});n[o.name]=e[Math.floor(Math.random()*e.length)]}return n}}class g{constructor(e,t,s,a,r){this.notificationsGateway=e,this.storageGateway=t,this.webrtcGateway=s,this.tabsGateway=a,this.feedbackComponent=r,this.fallbackErrorActive=!1,this.authHandler=(e,t)=>--this.retry<0?{cancel:!0}:{authCredentials:{username:this.device.token,password:this.device.tokenSecret}},this.errorHandler=e=>{this.fallbackErrorCounter++,this.currentTabUrl&&!this.fallbackErrorActive&&this.fallbackErrorCounter>5&&this.noOfAttempts<5?(this.fallbackErrorActive=!0,console.log("RETRY CONNECTION"),this.noOfAttempts++,this.connect(this.countryConnected,this.excludedPagesOnConnect,this.typeConnected).then(()=>{this.fallbackErrorActive=!1,this.tabsGateway.refreshCurrentTab()})):console.log("PENDING CONNECTION")},this.errorNavigationHandler=e=>{this.activeConnection&&e.error.includes("ERR_PROXY_CERTIFICATE_INVALID")&&(console.log("RETRY CONNECTION"),this.connect(this.countryConnected,this.excludedPagesOnConnect,this.typeConnected).then(()=>{this.fallbackErrorActive=!1,this.tabsGateway.refreshCurrentTab()}))},this.urlParser=new n,this.pacengine=new u,this.icons=new o,this.config=new i,this.rules=[],this.locations=[],this.excludedPagesOnConnect=[],this.typeConnected="browsing",this.useRules=!1,this.activeConnection=!1,this.blockchainConnected=!1,this.smartLocationConnected=!1,this.device=null,this.noOfAttempts=0,this.currentTabUrl="",this.restoredConnection=!1}init(){return new Promise(e=>{this.disconnect().then(()=>this.restoreConnection()),chrome.tabs.onActivated.addListener(e=>{setTimeout(()=>{(this.activeConnection||this.smartLocationConnected)&&this.setIconState(e.tabId)},200)}),chrome.tabs.onUpdated.addListener((e,t,s)=>{s.active&&"complete"!==t.status&&s&&(this.fallbackErrorCounter=0,this.retry=10,this.setIconState(e))}),e({msg:!0})})}connect(e,t=[],s="browsing"){t=t||[],t=[...t,...this.config.get("localDomains"),...this.config.get("privateNetworks")],this.storeConnectionProperties(e,t,s);let n=null;n=this.storageGateway.get("browsing"===s?"browsingServers":"streamingServers");const o=this.storageGateway.get("rules"),a=this.storageGateway.get("enabledRules"),r=this.storageGateway.get("device"),i=this.disconnect(!1);return new Promise((s,c)=>{Promise.all([n,o,a,r,i]).then(([n,o,a,r,i])=>{if(!r)return c("Invalid device"),!1;if(!n)return c("No locations for the moment"),!1;this.config.get("additionalLocations").length&&(n=n.concat(this.config.get("additionalLocations"))),this.locations=n,this.useRules=a,this.device=r,this.retry=10,chrome.webRequest.onAuthRequired.addListener(this.authHandler,{urls:["<all_urls>"]},["blocking"]);let h=null;if(a){this.rules=o;const s=this.pacengine.getNodeDictFromLocations(n,[]);h={value:{mode:"pac_script",pacScript:{data:this.pacengine.exportPAC(e,s,o,t)}},scope:"regular"}}else{const s=n.find(t=>t.name===e);if(!s)return c("Location not found"+e),!1;const o=s.nodes[Math.floor(Math.random()*s.nodes.length)],[a,r]=o.dnsname.split(":"),i={value:{mode:"fixed_servers",rules:{singleProxy:{scheme:"https",host:a,port:Number(r)||443},bypassList:[...t]}},scope:"regular"};this.proxyConnected=o,h=i}chrome.proxy.settings.set(h,e=>{console.log("-- proxy server enabled");const t=(new Date).getTime();axios.get(`https://zenmate.com/ping.html?${t}`).then(()=>{}),this.restoredConnection&&(this.tabsGateway.refreshCurrentTab(),this.restoredConnection=!1),this.feedbackComponent.sendConnectionEvent()}),"DEFAULT"!==e?this.activeConnection=!0:this.smartLocationConnected=!0,this.blockchainConnected=!1,this.tabsGateway.getCurrentTab().then(e=>{e[0]&&this.setIconState(e[0].id)}),this.webrtcGateway.disableWebRTC(),this.fallbackErrorCounter=0,chrome.proxy.onProxyError.addListener(this.errorHandler),s({message:!0})}).catch(e=>(c("Promise all failed"),!1))})}disconnect(e=!0){return new Promise((t,s)=>{this.webrtcGateway.enableWebRTC(),chrome.proxy.settings.set({value:{mode:"direct"},scope:"regular"},e=>{console.log("-- connection disabled")}),this.activeConnection=!1,this.blockchainConnected=!1,this.useRules=!!e&&this.useRules,chrome.webRequest.handlerBehaviorChanged(),chrome.webRequest.onAuthRequired.removeListener(this.authHandler),chrome.proxy.onProxyError.removeListener(this.errorHandler),this.tabsGateway.getCurrentTab().then(e=>{e[0]&&this.setIconState(e[0].id)}),this.noOfAttempts=0,this.useRules&&this.connect("DEFAULT",this.excludedPagesOnConnect,this.typeConnected),t({message:!0})})}connectFixed(e,t){return new Promise((s,n)=>{const[o,a]=e.split(":"),r={GB:`HTTPS ${o}:${a?a.trim():443}`},i=this.pacengine.exportPAC("DEFAULT",r,[{domain:"zenmate.com",cc:"GB"},{domain:"zenguard.biz",cc:"GB"}],t);chrome.proxy.settings.set({value:{mode:"pac_script",pacScript:{data:i}},scope:"regular"},e=>{this.blockchainConnected=!0,console.log("-- connection enabled"),localStorage.setItem("fallbackConnected","1"),s({message:!0})})})}removeNode(e,t){return new Promise((s,n)=>{const o=this.locations.find(e=>e.name===t),a=o.nodes.findIndex(t=>t===e);o.nodes.splice(a,1)})}getCurrentState(e,t){const s=this.pacengine.getProxyStateByURL(e,t.host,this.rules),n={isDefault:"DEFAULT"===s,isLocal:"LOCAL"===s,isDirect:"OFF"===s,isRuleActive:!1,customCountry:null};return n.isRuleActive=!(n.isDefault||n.isLocal),n.isRuleActive&&!n.isDirect&&(n.customCountry=s),n}setIconState(e){chrome.tabs.get(e,e=>{if(this.currentTabUrl=e.url.startsWith("chrome://")?null:e.url,e.url){const t=this.urlParser.parse(e.url),s=this.getCurrentState(e.url,t);this.useRules&&s.isRuleActive?(this.icons.setIconBadge(s.customCountry),this.icons.setIconImage("enabled"),this.storageGateway.set("smartLocationConnected",s.customCountry)):this.activeConnection?(this.icons.setIconBadge(this.countryConnected),this.icons.setIconImage("enabled"),this.storageGateway.set("smartLocationConnected",null)):this.device?(this.icons.setIconBadge(""),this.icons.setIconImage("disabled"),this.storageGateway.set("smartLocationConnected",null)):(this.icons.setIconBadge(""),this.icons.setIconImage("signedout"),this.storageGateway.set("smartLocationConnected",null)),this.checkBlockChainStatus(t,e)}})}toggleRules(e){return new Promise((t,s)=>{this.activeConnection?this.connect(this.countryConnected,this.excludedPagesOnConnect,this.typeConnected):e?this.connect("DEFAULT",this.excludedPagesOnConnect,this.typeConnected):this.disconnect(!1),t({message:!0})})}toggleWebRTC(e){return new Promise((t,s)=>{e?this.webrtcGateway.checkPermission().then(e=>{e?(this.webrtcGateway.disableWebRTC(),t({message:!0})):(this.storageGateway.set("webrtcProtection",!1),s(!1))}):this.webrtcGateway.enableWebRTC()})}checkBlockChainStatus(e,t){}storeConnectionProperties(e,t,s){this.countryConnected=e,this.excludedPagesOnConnect=t,this.typeConnected=s}restoreConnection(){const e=this.storageGateway.get("proxyCountry"),t=this.storageGateway.get("proxyPageExludes"),s=this.storageGateway.get("proxyType"),n=this.storageGateway.get("activeConnection"),o=this.storageGateway.get("enabledRules"),a=this.storageGateway.get("device");return new Promise((r,i)=>{Promise.all([e,t,s,n,o,a]).then(([e,t,s,n,o,a])=>{if(!a)return this.device=null,this.icons.setIconBadge(""),this.icons.setIconImage("signedout"),!1;this.device=a,1===n&&e?(t=t||[],s=s||"browsing",this.restoredConnection=!0,this.connect(e,t,s).then(()=>{const e=new Date;this.storageGateway.set("dateConnected",e.getTime())})):o&&this.connect("DEFAULT",t,"browsing").then()})})}}class m{constructor(e,t,s,a,r){this.notificationsGateway=e,this.storageGateway=t,this.webrtcGateway=s,this.tabsGateway=a,this.feedbackComponent=r,this.ffProxyInfo={type:"direct",host:null,port:null},this.fallbackErrorActive=!1,this.authHandler=e=>--this.retry<0?{cancel:!0}:{authCredentials:{username:this.device.token,password:this.device.tokenSecret}},this.handleProxyRequest=e=>this.ffProxyInfo,this.errorHandler=e=>{this.fallbackErrorCounter++,this.currentTabUrl&&!this.fallbackErrorActive&&this.fallbackErrorCounter>5&&this.noOfAttempts<5?(this.fallbackErrorActive=!0,console.log("RETRY CONNECTION"),this.noOfAttempts++,this.connect(this.countryConnected,this.excludedPagesOnConnect,this.typeConnected).then(()=>{this.fallbackErrorActive=!1,this.tabsGateway.refreshCurrentTab()})):console.log("PENDING CONNECTION")},this.rules=[],this.locations=[],this.nodeDict={},this.useRules=!1,this.activeConnection=!1,this.blockchainConnected=!1,this.urlParser=new n,this.pacengine=new u,this.icons=new o,this.config=new i,this.noOfAttempts=0,this.currentTabUrl=null,this.restoredConnection=!1,this.ffProxyInfo={type:"direct",host:null,port:null},this.init()}init(){return new Promise(e=>{this.disconnect().then(()=>this.restoreConnection()),chrome.tabs.onUpdated.addListener((e,t,s)=>{if((this.activeConnection||this.blockchainConnected)&&s.active&&"complete"!==t.status&&s){const t=this.getCurrentState(s.url);if(this.useRules&&t.isRuleActive){let e=null;if(this.nodeDict[t.customCountry])e=this.nodeDict[t.customCountry];else{const s=this.locations.find(e=>e.name===t.customCountry);e=s.nodes[Math.floor(Math.random()*s.nodes.length)].dnsname}const[n,o]=e.split(":");this.ffProxyInfo={type:"https",host:n,port:Number(o)||443},this.storageGateway.get("tab_rule_"+s.id).then(e=>{e!==t.customCountry&&this.storageGateway.set("tab_rule_"+s.id,t.customCountry).then(()=>{chrome.tabs.reload(s.id)})}).catch(()=>{this.storageGateway.set("tab_rule_"+s.id,t.customCountry).then(()=>{chrome.tabs.reload(s.id)})})}else if(this.defaultNode){const[e,t]=this.defaultNode.dnsname.split(":");this.ffProxyInfo={type:"https",host:e,port:Number(t)||443}}else this.ffProxyInfo={type:"direct",host:null,port:null};this.fallbackErrorCounter=0,this.retry=10,this.setIconState(e)}}),chrome.tabs.onActivated.addListener(e=>{setTimeout(()=>{this.setIconState(e.tabId)},200)}),e({msg:!0})})}connect(e,t,s="browsing"){t=t||[],t=[...t,...this.config.get("localDomains"),...this.config.get("privateNetworks")],this.storeConnectionProperties(e,t,s);let n=null;n=this.storageGateway.get("browsing"===s?"browsingServers":"streamingServers");const o=this.storageGateway.get("rules"),a=this.storageGateway.get("enabledRules"),r=this.storageGateway.get("device");return new Promise((t,s)=>{Promise.all([n,o,a,r]).then(([n,o,a,r])=>{if(!r)return this.device=null,this.icons.setIconBadge(""),this.icons.setIconImage("signedout"),!1;if(!n)return console.error("No locations for the moment"),s("No locations for the moment"),!1;this.config.get("additionalLocations").length&&(n=n.concat(this.config.get("additionalLocations"))),this.rules=o,this.useRules=a,this.locations=n;const i=n.find(t=>t.name===e);if(!i)return console.error("Location not found"),s("Location not found"),!1;this.device=r,this.retry=10,browser.webRequest.onAuthRequired.addListener(this.authHandler,{urls:["<all_urls>"]},["blocking"]),a&&(this.nodeDict=this.pacengine.getNodeDictFromLocations(n,[],!0));const c=i.nodes[Math.floor(Math.random()*i.nodes.length)];this.defaultNode=c;const[h,l]=c.dnsname.split(":");this.ffProxyInfo={type:"https",host:h,port:Number(l)||443},browser.proxy.onRequest.addListener(this.handleProxyRequest,{urls:["<all_urls>"]});const d=(new Date).getTime();axios.get(`https://zenmate.com/ping.html?${d}`).then(()=>{}),this.restoredConnection&&(this.tabsGateway.refreshCurrentTab(),this.restoredConnection=!1),this.webrtcGateway.disableWebRTC(),this.tabsGateway.getCurrentTab().then(e=>{e[0]&&this.setIconState(e[0].id)}),this.feedbackComponent.sendConnectionEvent(),this.activeConnection=!0,this.blockchainConnected=!1,this.proxyConnected=c,this.fallbackErrorCounter=0,browser.proxy.onError.addListener(this.errorHandler),t({message:!0})})})}disconnect(){return new Promise((e,t)=>{this.ffProxyInfo={type:"direct",host:null,port:null},this.activeConnection=!1,this.blockchainConnected=!1,browser.proxy.onRequest.removeListener(this.handleProxyRequest),browser.webRequest.onAuthRequired.removeListener(this.authHandler),browser.proxy.onError.removeListener(this.errorHandler),this.webrtcGateway.enableWebRTC(),this.tabsGateway.getCurrentTab().then(e=>{e[0]&&this.setIconState(e[0].id)}),this.noOfAttempts=0,this.activeConnection=!1,e({message:!0})})}shouldProxyRequest(e){return-1!==e.parentFrameId}connectFixed(e,t){return new Promise((t,s)=>{const[n,o]=e.split(":");this.ffProxyInfo={type:"https",host:n,port:Number(o)||443},this.nodeDict={GB:`${n}:${o?o.trim():443}`},this.rules=[{domain:"zenmate.com",cc:"GB"},{domain:"zenguard.biz",cc:"GB"}],this.useRules=!0,this.blockchainConnected=!0,this.defaultNode=null,browser.proxy.onRequest.addListener(this.handleProxyRequest,{urls:["<all_urls>"]}),browser.proxy.onError.addListener(e=>{}),t({message:!0})})}getCurrentState(e){const t=this.urlParser.parse(e),s=this.pacengine.getProxyStateByURL(e,t.host,this.rules),n={isDefault:"DEFAULT"===s,isLocal:"LOCAL"===s,isDirect:"OFF"===s,isRuleActive:!1,customCountry:null};return n.isRuleActive=!(n.isDefault||n.isLocal),n.isRuleActive&&!n.isDirect&&(n.customCountry=s),n}setIconState(e){chrome.tabs.get(e,e=>{if(this.currentTabUrl=e.url.startsWith("about:")?null:e.url,e.url){const t=this.getCurrentState(e.url);this.activeConnection&&this.useRules&&t.isRuleActive?(this.icons.setIconBadge(t.customCountry),this.icons.setIconImage("enabled"),this.storageGateway.set("smartLocationConnected",t.customCountry)):this.activeConnection?(this.icons.setIconBadge(this.countryConnected),this.icons.setIconImage("enabled"),this.storageGateway.set("smartLocationConnected",null)):this.device?(this.icons.setIconBadge(""),this.icons.setIconImage("disabled"),this.storageGateway.set("smartLocationConnected",null)):(this.icons.setIconBadge(""),this.icons.setIconImage("signedout"),this.storageGateway.set("smartLocationConnected",null))}})}toggleRules(e){return new Promise((e,t)=>{this.activeConnection&&this.connect(this.countryConnected,this.excludedPagesOnConnect,this.typeConnected),e({message:!0})})}toggleWebRTC(e){return new Promise((t,s)=>{e?this.webrtcGateway.checkPermission().then(e=>{e?(this.webrtcGateway.disableWebRTC(),t({message:!0})):(this.storageGateway.set("webrtcProtection",!1),s(!1))}):this.webrtcGateway.enableWebRTC()})}storeConnectionProperties(e,t,s){this.countryConnected=e,this.excludedPagesOnConnect=t,this.typeConnected=s}restoreConnection(){const e=this.storageGateway.get("proxyCountry"),t=this.storageGateway.get("proxyPageExludes"),s=this.storageGateway.get("proxyType"),n=this.storageGateway.get("activeConnection"),o=this.storageGateway.get("device");return new Promise((a,r)=>{Promise.all([e,t,s,n,o]).then(([e,t,s,n,o])=>{if(!o)return this.device=null,this.icons.setIconBadge(""),this.icons.setIconImage("signedout"),!1;1===n&&e&&(t=t||[],s=s||"browsing",this.restoredConnection=!0,this.connect(e,t,s).then(()=>{const e=new Date;this.storageGateway.set("dateConnected",e),this.tabsGateway.refreshCurrentTab()}))})})}}class b{constructor(){this.config=new i}log(...e){"prod"!==this.config.env&&console.log(...arguments)}error(...e){"prod"!==this.config.env&&(console.log("%c ZENMATE VPN ERROR ","color:#f00; font-size: 12px"),console.log(...arguments))}}class y{clear(e){chrome.alarms.clear(e)}clearAll(){chrome.alarms.clearAll()}create(e,t){chrome.alarms.create(e,t)}get(e){return new Promise(t=>{chrome.alarms.get(e,t)})}}class w{constructor(e,t,s,n){this.proxyGateway=e,this.cookiesGateway=t,this.tabsGateway=s,this.storageGateway=n,this.logger=new b,this.browserSchedule=new y,this.icons=new o}send(){chrome.runtime.sendMessage("hello",e=>{})}listen(){chrome.runtime.onMessage.addListener((e,t,s)=>{if(e.command){const t=e.command;let n,o,a;[n,o]=t.split(":"),a=e.args?e.args:[],this.callService(n,o,a).then(e=>{s({message:"ok",payload:e})}).catch(e=>{s({message:"error",error:e})})}if("updateWithCredentials"===e.subject&&e.payload.credentials&&e.payload.credentials.email&&e.payload.credentials.password&&!localStorage.getItem("device")){const t=CryptoJS.AES.encrypt(JSON.stringify(e.payload.credentials),"niGKhB95YrpRpTjpaY9dyRNcCSkn");this.storageGateway.remove("backgroundCredentials").then(()=>{this.storageGateway.set("backgroundCredentials",t.toString()),this.browserSchedule.create("removeCreds",{delayInMinutes:5}),this.browserSchedule.create("sendNotification",{delayInMinutes:0}),this.icons.setIconBadge("!")})}return"removeAutologinBadge"===e.subject&&this.icons.setIconBadge(""),!0})}init(){this.listen()}callService(e,t,s=[]){return this.hasOwnProperty(e)&&"function"==typeof this[e][t]?this[e][t](...s):new Promise((e,t)=>{t("Sevice or method not found")})}}class f{constructor(e,t){this.notificationsGateway=e,this.storageGateway=t,this.urlParser=new n,this.config=new i,this.notificationThreshold=5}init(){}listCookiesTab(e,t){let s=0;return new Promise((n,o)=>{chrome.cookies.getAll({domain:e},o=>{for(let n=0;n<o.length;n++)o[n].domain!==e&&o[n].domain!==t||s++;n(s)})})}listCookiesBrowser(){return new Promise((e,t)=>{chrome.cookies.getAll({},t=>{e(t.length)})})}clearBrowser(e,t){let s=[".google.com"];return s=this.generateExlusionList(),new Promise((n,o)=>{chrome.browsingData.remove({since:t,excludeOrigins:s},{appcache:e.cached,cache:e.cached,cacheStorage:e.cached,cookies:e.cookies,fileSystems:e.cached,formData:e.cached,indexedDB:e.cached,localStorage:e.cached,pluginData:e.cached,webSQL:e.cached,serviceWorkers:e.cached},()=>{chrome.history.search({text:"",startTime:t,maxResults:1e4},t=>{for(const e of t){const t=this.urlParser.parse(e.url);this.matchExludeDomains(t.domain,s)||chrome.history.deleteUrl({url:e.url},()=>!0)}this.incrementClearedCounter(),this.setStorageDates(e,1,null),n(!0)})})})}clearCurrentTab(e,t,s,n){return this.incrementClearedCounter(),this.setStorageDates(e,0,s),Promise.all([this.clearCurrentTabCookies(e,t,s,n),this.clearCurrentTabHistory(e,t,s,n)])}clearCurrentTabCookies(e,t,s,n){return new Promise((n,o)=>{let a=0;e.cookies?chrome.cookies.getAll({domain:t},e=>{for(let n=0;n<e.length;n++)e[n].domain!==t&&e[n].domain!==s||(chrome.cookies.remove({url:"https://"+e[n].domain+e[n].path,name:e[n].name}),a++);n(a)}):n(a)})}clearCurrentTabHistory(e,t,s,n){return new Promise((t,o)=>{e.cookies?chrome.history.search({text:s,startTime:n,maxResults:1e4},e=>{for(const t of e)chrome.history.deleteUrl({url:t.url},()=>!0);t(!0)}):t(!1)})}matchExludeDomains(e,t){for(let s=0;s<t.length;s++)if(t[s].includes(e))return!0;return!1}generateExlusionList(){const e=[];return[].forEach(t=>{e.push("https://"+t),e.push("http://"+t)}),e}sendNotification(){const e={en:{message:"Enjoying the CyberGhost Cookie Cleaner? Leave us a feedback!",yes_btn:"Sure!",no_btn:"No, thanks!"},de:{message:"Gefällt dir der CyberGhost Cookie Cleaner? Gib uns ein Feedback!",yes_btn:"Klar!",no_btn:"Nein, danke!"},es:{message:"¿Le gusta CyberGhost Cookie Cleaner? ¡Déjenos un comentario!",yes_btn:"¡Claro!",no_btn:"¡No, gracias!"},it:{message:"Ti piace CyberGhost Cookie Cleaner? Lascia un feedback!",yes_btn:"Certo!",no_btn:"No, grazie!"},ja:{message:"CyberGhost Cookie Cleanerをお楽しみいただいていますか？ ぜひフィードバックをお寄せください！",yes_btn:"フィードバックを送る",no_btn:"送らない"},ko:{message:"CyberGhost Cookie Cleaner가 마음에 드시나요? 사용자 의견을 남겨주세요!",yes_btn:"좋아요!",no_btn:"싫어요!"},nl:{message:"Vindt u CyberGhost Cookie Cleaner leuk? Geef ons uw feedback!",yes_btn:"Graag!",no_btn:"Nee, bedankt!"},pl:{message:"Spodobała Ci się aplikacja CyberGhost Cookie Cleaner? Przekaż nam opinię!",yes_btn:"Oczywiście!",no_btn:"Nie, dziękuję!"},pt:{message:"Gostou do CyberGhost Cookie Cleaner? Deixe-nos um comentário!",yes_btn:"Claro!",no_btn:"Não, obrigado!"},ro:{message:"Îți place CyberGhost Cookie Cleaner? Lasă un feedback!",yes_btn:"Desigur!",no_btn:"Nu, mulţumesc!"},ru:{message:"Нравится CyberGhost Cookie Cleaner? Оставьте отзыв!",yes_btn:"Разумеется!",no_btn:"Нет, спасибо!"},fr:{message:"Satisfait du CyberGhost Cookie Cleaner ? Laissez-nous un avis !",yes_btn:"Bien sûr !",no_btn:"Non, merci !"}};let t=navigator.language.split("-")[0];Object.keys(e).includes(t)||(t="en"),this.notificationsGateway.create(e[t])}incrementClearedCounter(){this.storageGateway.get("clearedCounter").then(e=>{let t=e?parseInt(e):0;t++,this.storageGateway.set("clearedCounter",t),t===this.notificationThreshold&&this.sendNotification()})}setStorageDates(e,t,s){const n=(new Date).getTime();e.browsing?(this.storageGateway.set(1===t?"erasedBrowsingTimeBrowser":"erasedBrowsingTime"+s,n.toString()),this.storageGateway.set("checkedBrowsing","1")):this.storageGateway.set("checkedBrowsing","0"),e.cookies?(this.storageGateway.set("erasedCookiesTime",n.toString()),this.storageGateway.set("checkedCookies","1")):this.storageGateway.set("checkedCookies","0"),e.cached?(1===t&&this.storageGateway.set("erasedCacheTime",n.toString()),this.storageGateway.set("checkedCache","1")):this.storageGateway.set("checkedCache","0")}addCookie(e,t,s){return new Promise((n,o)=>{const a=new Date;a.setHours(24,0,0,0),chrome.cookies.set({url:e,name:t,value:s,secure:!0,domain:this.config.get("domain"),expirationDate:a.getTime()},e=>{n({msg:!0})})})}getCookie(e=null){return new Promise((t,s)=>{e?chrome.cookies.get(e,e=>{t(e)}):s({error:!0})})}}class p{constructor(e,t){this.notificationsGateway=e,this.storageGateway=t,this.urlParser=new n,this.config=new i,this.notificationThreshold=5}init(){}listCookiesTab(e,t){let s=0;return new Promise((n,o)=>{browser.cookies.getAll({domain:e}).then(o=>{for(let n=0;n<o.length;n++)o[n].domain!==e&&o[n].domain!==t||s++;n(s)})})}listCookiesBrowser(){return new Promise((e,t)=>{browser.cookies.getAll({}).then(t=>{e(t.length)})})}clearBrowser(e,t){return this.incrementClearedCounter(),this.setStorageDates(e,1,null),browser.browsingData.remove({since:t},{cache:e.cached,cookies:e.cookies,formData:e.cached,history:e.browsing,indexedDB:e.cached,serviceWorkers:e.cached})}clearCurrentTab(e,t,s,n){return this.incrementClearedCounter(),this.setStorageDates(e,0,s),Promise.all([this.clearCurrentTabCookies(e,t,s,n),this.clearCurrentTabHistory(e,t,s,n)])}clearCurrentTabCookies(e,t,s,n){return new Promise((n,o)=>{let a=0;e.cookies?browser.cookies.getAll({domain:t}).then(e=>{for(let n=0;n<e.length;n++)e[n].domain!==t&&e[n].domain!==s||(browser.cookies.remove({url:"https://"+e[n].domain+e[n].path,name:e[n].name}).then(),a++);n(a)}):n(a)})}clearCurrentTabHistory(e,t,s,n){return new Promise((t,o)=>{e.cookies?browser.history.search({text:s,startTime:n,maxResults:1e4}).then(e=>{for(const t of e)chrome.history.deleteUrl({url:t.url},()=>!0);t(!0)}):t(!1)})}sendNotification(){const e={en:{message:"Enjoying the CyberGhost Cookie Cleaner? Leave us a feedback!",yes_btn:"Sure!",no_btn:"No, thanks!"},de:{message:"Gefällt dir der CyberGhost Cookie Cleaner? Gib uns ein Feedback!",yes_btn:"Klar!",no_btn:"Nein, danke!"},es:{message:"¿Le gusta CyberGhost Cookie Cleaner? ¡Déjenos un comentario!",yes_btn:"¡Claro!",no_btn:"¡No, gracias!"},it:{message:"Ti piace CyberGhost Cookie Cleaner? Lascia un feedback!",yes_btn:"Certo!",no_btn:"No, grazie!"},ja:{message:"CyberGhost Cookie Cleanerをお楽しみいただいていますか？ ぜひフィードバックをお寄せください！",yes_btn:"フィードバックを送る",no_btn:"送らない"},ko:{message:"CyberGhost Cookie Cleaner가 마음에 드시나요? 사용자 의견을 남겨주세요!",yes_btn:"좋아요!",no_btn:"싫어요!"},nl:{message:"Vindt u CyberGhost Cookie Cleaner leuk? Geef ons uw feedback!",yes_btn:"Graag!",no_btn:"Nee, bedankt!"},pl:{message:"Spodobała Ci się aplikacja CyberGhost Cookie Cleaner? Przekaż nam opinię!",yes_btn:"Oczywiście!",no_btn:"Nie, dziękuję!"},pt:{message:"Gostou do CyberGhost Cookie Cleaner? Deixe-nos um comentário!",yes_btn:"Claro!",no_btn:"Não, obrigado!"},ro:{message:"Îți place CyberGhost Cookie Cleaner? Lasă un feedback!",yes_btn:"Desigur!",no_btn:"Nu, mulţumesc!"},ru:{message:"Нравится CyberGhost Cookie Cleaner? Оставьте отзыв!",yes_btn:"Разумеется!",no_btn:"Нет, спасибо!"},fr:{message:"Satisfait du CyberGhost Cookie Cleaner ? Laissez-nous un avis !",yes_btn:"Bien sûr !",no_btn:"Non, merci !"}};let t=navigator.language.split("-")[0];Object.keys(e).includes(t)||(t="en"),this.notificationsGateway.create(e[t])}incrementClearedCounter(){this.storageGateway.get("clearedCounter").then(e=>{let t=e?parseInt(e,10):0;t++,this.storageGateway.set("clearedCounter",t),t===this.notificationThreshold&&this.sendNotification()})}setStorageDates(e,t,s){const n=(new Date).getTime();e.browsing?(this.storageGateway.set(1===t?"erasedBrowsingTimeBrowser":"erasedBrowsingTime"+s,n.toString()),this.storageGateway.set("checkedBrowsing","1")):this.storageGateway.set("checkedBrowsing","0"),e.cookies?(this.storageGateway.set("erasedCookiesTime",n.toString()),this.storageGateway.set("checkedCookies","1")):this.storageGateway.set("checkedCookies","0"),e.cached?(1===t&&this.storageGateway.set("erasedCacheTime",n.toString()),this.storageGateway.set("checkedCache","1")):this.storageGateway.set("checkedCache","0")}addCookie(e,t,s){return new Promise((n,o)=>{const a=new Date;a.setHours(24,0,0,0),chrome.cookies.set({url:e,name:t,value:s,secure:!0,domain:this.config.get("domain"),expirationDate:a.getTime()},e=>{n({msg:!0})})})}getCookie(e=null){return new Promise((t,s)=>{e?chrome.cookies.get(e,e=>{t(e)}):s({error:!0})})}}class C{constructor(){this.currentTab=null,this.urlParser=new n}getCurrentTab(){return new Promise((e,t)=>{chrome.tabs.query({currentWindow:!0,active:!0},t=>{e(t)})})}getCurrentTabInfo(){return new Promise((e,t)=>{chrome.tabs.query({currentWindow:!0,active:!0},s=>{if(s[0]){const t=this.urlParser.parse(s[0].url);e(t)}else t("Error on fetching CurrentTabInfo: no tabs[0]")})})}getTest(e=null,t=null,s=null){}refreshTab(e){return chrome.tabs.reload(e),!0}refreshCurrentTab(){return this.getCurrentTab().then(e=>{chrome.tabs.reload(e[0].id)}),!0}openTab(e){return new Promise((t,s)=>{chrome.tabs.create({url:e}),t(!0)})}isValidDomain(e){}parseUrl(e){}listenToTabChange(){chrome.tabs.onUpdated.addListener((e,t,s)=>{})}}class k{get(e,t=!1){return new Promise((s,n)=>chrome.storage.local.get(e,o=>{o.hasOwnProperty(e)?s(o[e]):t?n(`Element ${e} not found`):s(null)}))}remove(e){return new Promise(t=>chrome.storage.local.remove(e,t))}set(e,t){return new Promise((s,n)=>(void 0!==e&&0!==e.length||(console.log("ChromeStorageGateway set invalid key",e),n("invalid key")),void 0!==t&&0!==e.length||(console.log("ChromeStorageGateway set invalid value",e),n("invalid value")),chrome.storage.local.set({[e]:t},s)))}clear(){return new Promise(e=>chrome.storage.local.clear(e))}}class v{constructor(){this.options={browsing:!0,cookies:!0,cached:!1},this.urlParser=new n}init(){}contextOption(e){}showContextMenuWhitelist(e){}}class G{constructor(){this.options={browsing:!0,cookies:!0,cached:!1},this.urlParser=new n}init(){}contextOption(e){}showContextMenuWhitelist(e){}}class P{constructor(e){this.tabsGateway=e}create(e){return new Promise((t,s)=>{let n;const o=[];e.yes_btn&&o.push({title:e.yes_btn}),e.no_btn&&o.push({title:e.no_btn}),chrome.notifications.create("",{type:"basic",iconUrl:chrome.extension.getURL("icons/standard-128.png"),title:e.title?e.title:"Zenmate Extension",message:e.message?e.message:"Zenmate Extension",buttons:o},(function(e){n=e})),chrome.notifications.onButtonClicked.addListener((t,s)=>{t===n&&0===s&&e.link&&this.tabsGateway.openTab(e.link)}),chrome.notifications.onClicked.addListener(()=>{e.link&&this.tabsGateway.openTab(e.link)}),chrome.notifications.onClosed.addListener((function(){}))})}}class T{constructor(e){this.tabsGateway=e}create(e){return new Promise((t,s)=>{browser.notifications.create("test",{type:"basic",iconUrl:chrome.extension.getURL("icons/standard-128.png"),title:e.title?e.title:"Zenmate Extension",message:e.message?e.message:"Zenmate Extension"}),browser.notifications.onClicked.addListener(()=>{e.link&&this.tabsGateway.openTab(e.link),browser.notifications.clear("test").then(()=>{})}),browser.notifications.onButtonClicked.addListener((e,t)=>{browser.notifications.clear(e)})})}}class x{constructor(e){this.storageGateway=e}disableWebRTC(){return new Promise((e,t)=>{this.storageGateway.get("webrtcProtection").then(t=>{t&&null!=chrome.privacy&&null!=chrome.privacy.network&&null!=chrome.privacy.network.webRTCIPHandlingPolicy?(chrome.privacy.network.webRTCIPHandlingPolicy.set({value:"disable_non_proxied_udp"}),e(!0)):e(!1)})})}enableWebRTC(){return new Promise((e,t)=>{null!=chrome.privacy&&null!=chrome.privacy.network&&null!=chrome.privacy.network.webRTCIPHandlingPolicy?(chrome.privacy.network.webRTCIPHandlingPolicy.set({value:"default"}),e(!0)):e(!1)})}init(){}checkPermission(){return new Promise((e,t)=>{chrome.privacy?e(!0):this.requestPermissions().then(t=>{e(t)})})}requestPermissions(){const e=["privacy"];return new Promise(t=>chrome.permissions.request({permissions:e},e=>{t(e)}))}}class I{constructor(e){this.storageGateway=e}disableWebRTC(){return new Promise((e,t)=>{null!=browser.privacy&&null!=browser.privacy.network&&null!=browser.privacy.network.webRTCIPHandlingPolicy?(browser.privacy.network.webRTCIPHandlingPolicy.set({value:"proxy_only"}),e(!0)):e(!1)})}enableWebRTC(){return new Promise((e,t)=>{null!=browser.privacy&&null!=browser.privacy.network&&null!=browser.privacy.network.webRTCIPHandlingPolicy?(browser.privacy.network.webRTCIPHandlingPolicy.set({value:"default"}),e(!0)):e(!1)})}init(){}checkPermission(){return new Promise((e,t)=>{browser.privacy?e(!0):this.requestPermissions().then(t=>{e(t)})})}requestPermissions(){const e={permissions:["privacy"]};return new Promise(t=>Promise.resolve("foobar").then(s=>{browser.permissions.request(e).then(e=>{t(e)})}))}}class L{constructor(e){this.storageGateway=e,this.config=new i,this.device={id:"",tokenSecret:""}}refreshServers(){this.storageGateway.get("device").then(e=>{e&&(this.device=e,this.fetchServersByFilter(103).then(e=>{e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),this.storageGateway.set("browsingServers",e),this.storageGateway.remove("refreshServersError")}).catch(e=>{this.storageGateway.set("refreshServersError",1)}),this.fetchServersByFilter(104).then(e=>{e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),this.storageGateway.set("streamingServers",e),this.storageGateway.remove("refreshServersError")}).catch(e=>{this.storageGateway.set("refreshServersError",1)}))})}getBestServers(e,t){this.device=t,this.fetchServersByFilter(111,{filter_user_country:e.location.countrycode}).then(e=>{this.storageGateway.set("bestLocations",e)}).catch(e=>{})}fetchServersByFilter(e=124,t={}){return new Promise((s,n)=>{const o={"Content-Type":"application/json","x-app-key":this.config.get("api").key,"x-device-id":this.device.id,"x-device-secret":this.device.tokenSecret};axios.get(this.config.get("api").url+"/my/servers/filters/"+e,{headers:o,params:t}).then(e=>{const t=e.data;let n={};t.length&&(n=t.reduce((e,t)=>(e[t.countrycode]=e[t.countrycode]||{name:t.countrycode,nodes:[]},e[t.countrycode].nodes.push(t),e),Object.create(null)));const o=Object.values(n);s(o)}).catch(e=>{n(e)})})}}class R{constructor(e,t){this.storageGateway=e,this.notificationsGateway=t,this.config=new i}fetch(){const e=(new Date).getTime();axios.get(`https://zenmate-extension.s3-eu-west-1.amazonaws.com/cms/default.json?${e}`).then(e=>{this.storageGateway.set("campaignSettings",e.data),this.triggerOsNotification(e)}).catch(e=>{console.log("ERROR marketing error ",e)})}triggerOsNotification(e){e.data.hasOwnProperty("alert")&&this.storageGateway.get("accountOverview").then(t=>{if(t){const s=e.data.alert;for(const e of s){const s=JSON.parse(localStorage.getItem("language"))||"en",n=new Date,o=new Date(e.settings.startDate),a=new Date(e.settings.endDate),r=e.settings.env,i=e.content[s]||e.content.en,c=e.settings.subscription.includes(t.status),h=r.includes(this.config.get("env").name.toLocaleLowerCase());if(e.settings.active&&o<n&&n<a&&c&&h){this.storageGateway.get("campaign_alert").then(e=>{e||(this.notificationsGateway.create({message:i.message||"Test",title:i.title||"Zenmate Extension",yes_btn:i.btnText||"Sure!",link:i.link||"https://zenmate.com"}),this.storageGateway.set("campaign_alert",1))});break}}}})}}class S{constructor(e,t){this.storageGateway=e,this.cookiesGateway=t,this.config=new i,this.logger=new b,this.device={id:"",tokenSecret:""},this.cookiesGateway.getCookie({url:"https://zenmate.com",name:"zm_clickid"}).then(e=>{this.logger.log("get zm_clickid ",e),e&&(this.clickId=e.value)}),this.cookiesGateway.getCookie({url:"https://zenmate.com",name:"zm_offer_id"}).then(e=>{this.logger.log("get zm_offer_id ",e),e&&(this.offerID=e.value)}),this.cookiesGateway.getCookie({url:"https://zenmate.com",name:"zm_transaction_id"}).then(e=>{this.logger.log("get zm_transaction_id ",e),e&&(this.transactionID=e.value)})}getOrCreateClickID(){return new Promise(e=>{if(this.clickId)return void this.addClickData().then(()=>e(this.clickId));const t=this.config.get("feedbackUrl");axios.post(t+"feedback/?resolve=1",{clickData:{custom:{edition:"Regular"}}}).then(t=>{this.logger.log("AXIOS response ",t),this.clickId=t.data.clickId,this.cookiesGateway.addCookie("https://zenmate.com","zm_clickid",this.clickId).then(e=>{this.logger.log("addCookie cookie ",e)}),this.addClickData().then(()=>e(this.clickId))})})}addClickData(){const e=this.config.get("feedbackUrl");return new Promise(t=>{this.logger.log(this.offerID,this.transactionID),axios.put(`${e}feedback/${this.clickId}?resolve=1`,{clickId:this.clickId,clickData:{offer_id:this.offerID,transaction_id:this.transactionID,extension:!0}}).then(e=>{t(!0)})})}sendEvent(e){this.getOrCreateClickID().then(t=>{this.logger.log("sendEvent click id ",this.clickId),e.clickId=t;const s=this.config.get("feedbackUrl");this.logger.log("sendEvent click id ",this.clickId),axios.post(s+"events/?resolve=1",e).then(e=>{this.logger.log("axios sendEvent ",e)})})}sendConnectionEvent(){this.storageGateway.get("firstConnection").then(e=>{e||(this.sendEvent({environment:"zenmate",clickData:{extension:!0},eventType:"client_first_connection",eventData:{}}),this.storageGateway.set("firstConnection",1))})}}console.log("%c ZenMate VPN - The best free VPN","color:#008ACD; font-size: 32px"),new class{constructor(){this.isChrome="undefined"==typeof browser,this.storageGateway=new k,this.serversComponent=new L(this.storageGateway),this.browserSchedule=new y,this.icons=new o,this.config=new i,this.tabsGateway=new C,this.contextMenuGateway=this.isChrome?new v:new G,this.notificationsGateway=this.isChrome?new P(this.tabsGateway):new T(this.tabsGateway),this.marketingEventsComponent=new R(this.storageGateway,this.notificationsGateway),this.browserWebrtcGateway=this.isChrome?new x(this.storageGateway):new I(this.storageGateway),this.cookiesGateway="undefined"==typeof browser?new f(this.notificationsGateway,this.storageGateway):new p(this.notificationsGateway,this.storageGateway),this.cookiesGateway.init(),this.feedbackComponent=new S(this.storageGateway,this.cookiesGateway),this.proxyGateway=this.isChrome?new g(this.notificationsGateway,this.storageGateway,this.browserWebrtcGateway,this.tabsGateway,this.feedbackComponent):new m(this.notificationsGateway,this.storageGateway,this.browserWebrtcGateway,this.tabsGateway,this.feedbackComponent),this.proxyGateway.init(),this.mesageGateway=new w(this.proxyGateway,this.cookiesGateway,this.tabsGateway,this.storageGateway),this.mesageGateway.init(),this.initializeListeners(),this.browserSchedule.clearAll(),this.setAlarms(),this.isChrome||chrome.storage.local.get(null,e=>{if(e){const t=Object.keys(e);for(const e of t)e.startsWith("tab_rule_")&&this.storageGateway.remove(e)}}),this.pingWebsite()}setAlarms(){this.browserSchedule.create("marketing",{delayInMinutes:1,periodInMinutes:120}),this.browserSchedule.create("refreshServers",{delayInMinutes:2,periodInMinutes:180});const e=new Date;e.setHours(24,0,0,0),this.browserSchedule.create("resetCounters",{when:e.getTime(),periodInMinutes:1440}),this.browserSchedule.create("resetAlerts",{when:e.getTime(),periodInMinutes:1440}),this.alarmListener()}alarmListener(){chrome.alarms.onAlarm.addListener(e=>{if("marketing"===e.name?this.marketingEventsComponent.fetch():"refreshServers"===e.name&&this.serversComponent.refreshServers(),"removeCreds"===e.name&&(this.storageGateway.remove("backgroundCredentials"),this.icons.setIconBadge("")),"resetCounters"===e.name&&this.storageGateway.set("dailyConnection",0),"resetAlerts"===e.name&&this.storageGateway.set("campaign_alert",null),"sendNotification"===e.name){let e=JSON.parse(localStorage.getItem("language"))||"en";const t={en:{message:"Connect to the ZenMate VPN extension & get off the grid",title:"You’re logged in!"},ko:{message:"로그인하셨습니다!",title:"ZenMate VPN 확장에 연결하고 그리드에서 내리십시오"},ru:{message:"Вы вошли в систему!",title:"Подключитесь к расширению ZenMate VPN и выйдите из сети"},tr:{message:"Giriş yaptınız!",title:"ZenMate VPN uzantısına bağlanın ve şebekeden çıkın"},fr:{message:"Vous êtes connecté ! ",title:"Connectez-vous à l’extension ZenMate VPN & disparaissez des radars "},de:{message:"Du bist eingeloggt! ",title:"Verbinde dich über die ZenMate VPN-Erweiterung & bleib unabhängig"},nl:{message:"Je bent ingelogd!",title:"Maak verbinding met de ZenMate VPN-extensie en verlaat het netwerk"}};Object.keys(t).includes(e)||(e="en"),this.notificationsGateway.create(t[e])}})}initializeListeners(){chrome.runtime.onInstalled.addListener(()=>{console.log("Application was installed"),this.sendInstallEvent(),this.migrateStorage()}),chrome.runtime.onStartup.addListener(()=>{}),chrome.runtime.onConnect.addListener(()=>{}),chrome.runtime.onConnectExternal.addListener(()=>{}),"undefined"==typeof browser?chrome.runtime.setUninstallURL(`${this.config.get("websiteUrl")}/uninstall-ext`):browser.runtime.setUninstallURL(`${this.config.get("websiteUrl")}/uninstall-ext`),chrome.windows.onCreated.addListener(()=>{this.pingWebsite()})}pingWebsite(){}sendInstallEvent(){this.storageGateway.get("installed").then(e=>{e||(this.feedbackComponent.sendEvent({environment:"zenmate",clickData:{extension:!0},eventType:"client_install",eventData:{}}),this.storageGateway.set("installed",1))})}migrateStorage(){const e=this.storageGateway.get("user"),t=this.storageGateway.get("device"),s=this.storageGateway.get("enable_webrtc_proxy"),n=this.storageGateway.get("rules_enabled"),o=this.storageGateway.get("favorite_locations"),a=this.storageGateway.get("default_location");Promise.all([e,t,s,o,a,n]).then(([e,t,s,n,o,a])=>{t&&!t.id&&t.uuid&&(t.id=t.uuid),e&&localStorage.setItem("user",JSON.stringify(e)),t&&localStorage.setItem("device",JSON.stringify(t)),n&&this.storageGateway.set("favorites",n),s&&this.storageGateway.set("webrtcProtection",s),o&&this.storageGateway.set("proxyCountry",o),a&&this.storageGateway.set("enabledRules",a),t&&this.storageGateway.set("device",t).then(s=>{this.serversComponent.refreshServers(),e&&this.serversComponent.getBestServers(e,t)})})}}},OtEZ:function(e){e.exports=JSON.parse('{"env":{"name":"DEV"},"api":{"url":"https://beta-v2-api.zenguard.biz/v2","key":"ZMEx4hfuto83htix763jf9cz3n59f73v659f"},"apiv1":{"url":"https://beta-api.zenguard.biz/cg","key":"ZMEx4hfuto83htix763jf9cz3n59f73v659f"},"blockChainRPCNode":["https://api.myetherwallet.com/rop","https://ropsten.infura.io/v3/74c324cc4f75481d817e2cfd606f703d"],"blockchainFallback":true,"accountUrl":"https://dev-account.zenmate.com/","websiteUrl":"https://dev-www.zenmate.com/","supportUrl":"https://zenguard.zendesk.com/hc/","feedbackUrl":"https://feedback.zenmate.com/v2/","domain":".zenmate.com","availableLangs":["en","de","tr","fr","es","nl","ko","ru"],"campaign":"default","triggerCampaignCount":5,"triggerRating":{"free":2,"trial":3,"ultimate":4},"additionalLocations":[{"name":"TL","nodes":[{"dnsname":"blade1.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade2.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade3.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade4.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade5.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade6.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade7.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade8.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade9.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade10.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade11.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"},{"dnsname":"blade12.frankfurt-rack412.nodes.gen4.ninja:9001","countrycode":"TL"}]},{"name":"TT","nodes":[{"dnsname":"blade1.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"},{"dnsname":"blade2.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"},{"dnsname":"blade3.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"},{"dnsname":"blade4.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"},{"dnsname":"blade5.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"},{"dnsname":"blade6.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"},{"dnsname":"blade7.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"},{"dnsname":"blade8.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"},{"dnsname":"blade9.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"},{"dnsname":"blade10.manchester-rack401.nodes.gen4.ninja:9001","countrycode":"TT"}]},{"name":"UG","nodes":[{"dnsname":"blade1.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade2.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade3.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade4.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade5.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade6.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade7.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade8.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade9.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade10.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade11.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"},{"dnsname":"blade12.amsterdam-rack407.nodes.gen4.ninja:9001","countrycode":"UG"}]}]}')},pcxt:function(e){e.exports=JSON.parse('{"env":{"name":"PRODUCTION"},"api":{"url":"https://apiv2.zenguard.biz/v2","key":"ZMEx4hfuto83htix763jf9cz3n59f73v659f"},"apiv1":{"url":"https://api.zenguard.biz/cg","key":"ZMEx4hfuto83htix763jf9cz3n59f73v659f"},"blockChainRPCNode":["https://api.myetherwallet.com/rop","https://ropsten.infura.io/v3/74c324cc4f75481d817e2cfd606f703d"],"blockchainFallback":true,"accountUrl":"https://account.zenmate.com/","websiteUrl":"https://zenmate.com/","supportUrl":"https://zenguard.zendesk.com/hc/","feedbackUrl":"https://feedback.zenmate.com/v2/","domain":".zenmate.com","availableLangs":["en","de","tr","fr","es","nl","ko","ru"],"campaign":"default","triggerCampaignCount":10,"triggerRating":{"free":3,"trial":5,"ultimate":10},"additionalLocations":[]}')}},[["I9DD",0]]]);