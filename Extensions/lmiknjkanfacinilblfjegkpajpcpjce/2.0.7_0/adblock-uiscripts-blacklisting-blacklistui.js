function selector_from_elm(a){for(var b=["id","class","name","src","href","data"],c=[a.prop("nodeName")],d=0;d<b.length;d++){var e=b[d],f=a.attr(e);f&&c.push("["+e+"="+JSON.stringify(f)+"]")}return c.join("")}function BlacklistUi(a,b){this._cancelled=!0,this._current_step=0,this._callbacks={cancel:[],block:[]},this._clicked_item=a,this._advanced_user=b}BlacklistUi.prototype.cancel=function(a){this._callbacks.cancel.push(a)},BlacklistUi.prototype.block=function(a){this._callbacks.block.push(a)},BlacklistUi.prototype._fire=function(a,b){for(var c=this._callbacks[a],d=0;d<c.length;d++)c[d](b)},BlacklistUi.prototype._onClose=function(){!0==this._cancelled&&(this._ui_page1.empty().remove(),this._ui_page2.empty().remove(),$(".adblock-ui-stylesheet").remove(),this._chain.current().show(),this._fire("cancel"))},BlacklistUi.prototype.handle_change=function(){this._last.show(),this._chain.current().hide(),this._last=this._chain.current(),this._redrawPage1(),this._redrawPage2(),this._preview(selector_from_elm(this._chain.current()))},BlacklistUi.prototype.show=function(){if(null==this._clicked_item){var a=new ClickWatcher,b=this;return a.cancel(function(){b._preview(null),b._fire("cancel")}),a.click(function(a){b._clicked_item=a,b.show()}),this._preview("*"),void a.show()}this._chain=new ElementChain(this._clicked_item),this._ui_page1=this._build_page1(),this._ui_page2=this._build_page2(),this._last=this._chain.current(),this._chain.change(this,this.handle_change),this._chain.change(),this._redrawPage1(),this._ui_page1.dialog("open")},BlacklistUi.prototype._build_page1=function(){var a=Math.max,b=this,c=$("<div>").append(translate("sliderexplanation")).append("<br/>").append("<input id='slider' type='range' min='0' value='0'/>").append("<div id='selected_data'></div>"),d={},e=translate("buttonlooksgood");d[e]={text:e,class:"adblock_default_button",click:function(){b._cancelled=!1,b._ui_page1.dialog("close"),b._cancelled=!0,b._redrawPage2(),b._ui_page2.dialog("open")}},d[translate("buttoncancel")]=function(){b._ui_page1.dialog("close")},c.dialog({dialogClass:"adblock-blacklist-dialog",position:[50,50],width:410,autoOpen:!1,title:translate("slidertitle"),buttons:d,open:function(){b._current_step=1,b._preview(selector_from_elm(b._chain.current()))},close:function(){b._preview(null),b._onClose()}}),c.dialog("widget").css("position","fixed"),changeTextDirection($("body .adblock-blacklist-dialog"));for(var f=0,g=this._chain.current();0<g.length&&"BODY"!=g[0].nodeName;)g=g.parent(),f++;return $("#slider",c).attr("max",a(f-1,1)).on("input change",function(){b._chain.moveTo(this.valueAsNumber)}),c},BlacklistUi.prototype._build_page2=function(){var a=this,b=$("<div>"+translate("blacklisteroptions1")+"<div><div id='adblock-details'></div><br/><div id='count'></div></div><div><br/>"+translate("blacklisternotsure")+"<br/><br/></div><div style='clear:left; font-size:smaller; margin-top: -20px;'><br/>"+translate("blacklisterthefilter")+"<div style='margin-left:15px;margin-bottom:15px'><div><div id='summary'></div><br/><div id='filter_warning'></div></div></div></div></div>"),c={},d=translate("buttonblockit");return c[d]={text:d,class:"adblock_default_button",click:function(){var b=$("#summary",a._ui_page2).text();if(0<b.length){var c=getUnicodeDomain(document.location.hostname)+"##"+b;BGcall("addCustomFilter",c,function(){block_list_via_css([b]),a._ui_page2.dialog("close"),a._fire("block")})}else alert(translate("blacklisternofilter"))}},a._advanced_user&&(c[translate("buttonedit")]=function(){var b=getUnicodeDomain(document.location.hostname)+"##"+$("#summary",a._ui_page2).text();a._ui_page2.dialog("close"),b=prompt(translate("blacklistereditfilter"),b),b&&(!/\#\#/.test(b)&&(b="##"+b),BGcall("parseFilter",b,function(c){c.filter?BGcall("addCustomFilter",c.filter.text,function(c){c?alert(translate("blacklistereditinvalid1",c)):(block_list_via_css([b.substr(b.indexOf("##")+2)]),a._fire("block"))}):c.error&&c.error.type&&alert(translate("blacklistereditinvalid1",c.error.type))}))}),c[translate("buttonback")]=function(){a._cancelled=!1,a._ui_page2.dialog("close"),a._cancelled=!0,a._redrawPage1(),a._ui_page1.dialog("open")},c[translate("buttoncancel")]=function(){a._ui_page2.dialog("close")},b.dialog({dialogClass:"adblock-blacklist-dialog ui-page-2",position:[50,50],width:500,autoOpen:!1,title:translate("blacklisteroptionstitle"),buttons:c,open:function(){a._current_step=2,a._preview($("#summary",a._ui_page2).text())},close:function(){a._preview(null),a._onClose()}}),b.dialog("widget").css("position","fixed"),changeTextDirection($("body .adblock-blacklist-dialog")),b},BlacklistUi.prototype._redrawPage1=function(){var a=this._chain.current(),b=$("#selected_data",this._ui_page1);b.html("<b>"+translate("blacklisterblockedelement")+"</b><br/>"),b.append($("<i></i>").text("<"+a[0].nodeName));var c=["id","class","name","src","href","data"];for(var d in c){var e=BlacklistUi._ellipsis(a.attr(c[d]));e&&b.append("<br/>").append($("<i></i>").text(c[d]+"=\""+e+"\"").css("margin-left","10px"))}b.append("<i>&nbsp;&gt;</i>")},BlacklistUi.prototype._makeFilter=function(){var a=[],b=this._chain.current(),c=$("#adblock-details",this._ui_page2);if($("input[type='checkbox']#cknodeName",c).is(":checked")&&(a.push(b.prop("nodeName")),"IFRAME"==b.prop("nodeName")&&""==b.attr("id")))for(var d=b.parent();"BODY"!=d.prop("nodeName");)a.unshift(d.prop("nodeName")+" "),d=d.parent();var e=["id","class","name","src","href","data"];for(var f in e)$("input[type='checkbox']#ck"+e[f],c).is(":checked")&&a.push("["+e[f]+"="+JSON.stringify(b.attr(e[f]))+"]");var g;return 0==a.length?g=translate("blacklisterwarningnofilter"):1==a.length&&$("input[type='checkbox']#cknodeName",c).is(":checked")&&(g=translate("blacklisterblocksalloftype",[a[0]])),$("#filter_warning",this._ui_page2).css("display",g?"block":"none").text(g),a.join("")},BlacklistUi.prototype._redrawPage2=function(){function a(){var a=c._makeFilter();e.text(a);var b=$(a).not(".ui-dialog").not(".ui-dialog *").length;$("#count",c._ui_page2).html("<center>"+(1==b?translate("blacklistersinglematch"):translate("blacklistermatches",["<b>"+b+"</b>"]))+"</center>")}var b=this._chain.current(),c=this,d=$("#adblock-details",c._ui_page2),e=$("#summary",c._ui_page2);d.empty();for(var f=["nodeName","id","class","name","src","href","data"],g=0;g<f.length;g++){var h=f[g],j="nodeName"==h?b.prop("nodeName"):b.attr(h),k=BlacklistUi._ellipsis(j);if(k){var l=!0;("src"==h||"href"==h||"data"==h)&&(l=1==$("input",d).length);var m=$("<i></i>").text(k),n=$("<label></label>").html(translate("blacklisterattrwillbe",["<b>"+("nodeName"==h?translate("blacklistertype"):h)+"</b>","<i></i>"])).attr("for","ck"+h);$("i",n).replaceWith(m);var o=$("<div></div>").append("<input type=checkbox "+(l?"checked=\"checked\"":"")+" id=ck"+h+" /> ").append(n);o.find("input").change(function(){a(),c._preview($("#summary",c._ui_page2).text())}),d.append(o)}}a()},BlacklistUi.prototype._preview=function(a){if($("#adblock_blacklist_preview_css").remove(),!!a){var b=document.createElement("style");b.type="text/css",b.id="adblock_blacklist_preview_css";switch(this._current_step){case 0:b.innerText="body .adblock-highlight-node,";break;case 1:b.innerText="body .adblock-blacklist-dialog, body .adblock-blacklist-dialog * {opacity:1!important;} ",b.innerText+=a+" {opacity:.1!important;} "+a+" "+a+" {opacity:1!important;}";break;case 2:b.innerText="body .adblock-blacklist-dialog input, body .adblock-blacklist-dialog button {display:inline-block!important;} body .adblock-blacklist-dialog.ui-page-2, body .adblock-blacklist-dialog div:not(#filter_warning), body .adblock-blacklist-dialog .ui-icon, body .adblock-blacklist-dialog a, body .adblock-blacklist-dialog center {display:block!important;} body .adblock-blacklist-dialog #adblock-details, body .adblock-blacklist-dialog span, body .adblock-blacklist-dialog b, body .adblock-blacklist-dialog i {display:inline!important;} ",b.innerText+=a+" {display:none!important;}";}b.innerText+=" body .adblock-blacklist-dialog {z-index:2147483647!important;}",document.documentElement.appendChild(b)}},BlacklistUi._ellipsis=function(a,b){if(null==a)return a;null==b&&(b=50),a=getUnicodeUrl(a);var c=b/2-2;return a.length>b&&(a=a.substring(0,c)+"..."+a.substring(a.length-c)),a};