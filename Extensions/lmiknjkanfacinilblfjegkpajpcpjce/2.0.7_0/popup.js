"use strict";const{require}=ext.backgroundPage.getWindow(),{Filter}=require("filterClasses"),{FilterStorage}=require("filterStorage"),{Prefs}=require("prefs"),{checkWhitelisted}=require("whitelisting"),{getDecodedHostname}=require("url");let page=null;function onLoad(){ext.pages.query({active:!0,lastFocusedWindow:!0},a=>{page=a[0],page&&("http:"==page.url.protocol||"https:"==page.url.protocol)?!require("filterComposer").isPageReady(page)&&(document.body.classList.add("nohtml"),require("messaging").getPort(window).on("composer.ready",(a,b)=>{b.page.id==page.id&&document.body.classList.remove("nohtml")})):document.body.classList.add("local"),page&&(checkWhitelisted(page)&&document.body.classList.add("disabled"),page.sendMessage({type:"composer.content.getState"},a=>{a&&a.active&&document.body.classList.add("clickhide-active")}))}),document.getElementById("enabled").addEventListener("click",toggleEnabled,!1),document.getElementById("clickhide").addEventListener("click",activateClickHide,!1),document.getElementById("clickhide-cancel").addEventListener("click",cancelClickHide,!1),document.getElementById("options").addEventListener("click",()=>{ext.showOptions()},!1);for(let a of document.getElementsByClassName("collapse"))a.addEventListener("click",toggleCollapse,!1),Prefs[a.dataset.option]||document.getElementById(a.dataset.collapsable).classList.add("collapsed")}function toggleEnabled(){let a=document.body.classList.toggle("disabled");if(a){let a=getDecodedHostname(page.url).replace(/^www\./,""),b=Filter.fromText("@@||"+a+"^$document");b.subscriptions.length&&b.disabled?b.disabled=!1:(b.disabled=!1,FilterStorage.addFilter(b))}else for(let a=checkWhitelisted(page);a;)FilterStorage.removeFilter(a),a.subscriptions.length&&(a.disabled=!0),a=checkWhitelisted(page)}function activateClickHide(){document.body.classList.add("clickhide-active"),page.sendMessage({type:"composer.content.startPickingElement"}),activateClickHide.timeout=window.setTimeout(ext.closePopup,5e3)}function cancelClickHide(){activateClickHide.timeout&&(window.clearTimeout(activateClickHide.timeout),activateClickHide.timeout=null),document.body.classList.remove("clickhide-active"),page.sendMessage({type:"composer.content.finished"})}function toggleCollapse(a){let b=a.currentTarget;Prefs[b.dataset.option]=!Prefs[b.dataset.option],b.parentNode.classList.toggle("collapsed")}document.addEventListener("DOMContentLoaded",onLoad,!1);