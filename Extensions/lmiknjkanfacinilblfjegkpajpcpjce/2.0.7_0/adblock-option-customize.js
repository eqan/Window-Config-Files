var originalCustomFilters;function cleanCustomFilter(a){if(backgroundPage.adblockIsPaused()){var b=a.indexOf("@@");0<=b&&a.splice(b,1);var b=a.indexOf("@@^$document");0<=b&&a.splice(b,1)}return a}function onFilterChange(a){if("save"===a&&!0===$("#txtFiltersAdvanced").prop("disabled")){var b=backgroundPage.getUserFilters();b&&b.length&&(originalCustomFilters=cleanCustomFilter(b),$("#txtFiltersAdvanced").val(originalCustomFilters.join("\n")))}}$(function(){function a(a){var b=$("#txtFiltersAdvanced");b.val(a+"\n"+$("#txtFiltersAdvanced").val()),d(),$(".addControls").slideUp()}function b(a){return a=a.trim().replace(/[\ \,\;\|]+\~?/g,"|~"),a&&"~"!=a[0]&&(a="~"+a),a}function c(a){for(var b,c=a.split("\n"),d={},e=[],f=0;f<c.length;f++)if(b=c[f],0>e.indexOf(b)&&-1<b.indexOf("##")){e.push(b);var g=b.split("##")[0];d[g]=(d[g]||0)+1}backgroundPage.updateCustomFilterCountMap(d)}function d(){var a=$("#txtFiltersAdvanced").val(),b=a.split("\n"),d="";$("#messagecustom").html(d),$("#messagecustom").hide();for(var e,f=0;!d&&f<b.length;f++)if(e=b[f],e=e.trim(),0<e.length){var g=parseFilter(e);g.error&&(d=translate("customfilterserrormessage",[e,g.error]))}if(d)$("#messagecustom").html(d),$("#messagecustom").show();else{backgroundPage.adblockIsPaused()&&(b.push("@@"),b.push("@@^$document"));for(var e,f=0;f<b.length;f++)if(e=b[f],e=e.trim(),0<e.length){var g=parseFilter(e);g.filter&&FilterStorage.addFilter(g.filter)}if(originalCustomFilters)for(var e,f=0;f<originalCustomFilters.length;f++)if(e=originalCustomFilters[f],-1===b.indexOf(e)&&(e=e.trim(),0<e.length)){var g=parseFilter(e);g.filter&&FilterStorage.removeFilter(g.filter)}originalCustomFilters=b,c(a),$("#divAddNewFilter").slideDown(),$("#txtFiltersAdvanced").prop("disabled",!0),$("#spanSaveButton").hide(),$("#btnEditAdvancedFilters").show()}}$("#tutorlink").attr("href",Utils.getDocLink("filterdoc"));var e=function(){chrome.storage.local.get("exclude_filters",function(a){a.exclude_filters&&($("#txtExcludeFiltersAdvanced").val(a.exclude_filters),$("#divExcludeFilters").show())})};e(),chrome.storage.local.get("custom_filters_errors",function(a){a.custom_filters_errors&&($("#txtMigrationErrorMessage").val(a.custom_filters_errors),$("#migrationErrorMessageDiv").show(),$("#btnDeleteMigrationErrorMessage").click(function(){chrome.storage.local.remove("custom_filters_errors"),$("#migrationErrorMessageDiv").hide()}))}),$("#txtBlacklist").focus(function(){var a=$("#txtFiltersAdvanced").val(),b=a.match(/^@@\*\$document,domain\=(~.*)$/m);b&&""==$(this).val()&&$(this).val(b[1])}),$("#btnAddUserFilter").click(function(){var b=$("#txtUserFilterCss").val().trim(),c=$("#txtUserFilterDomain").val().trim();".*"==c||"*"==c||""==c?a("##"+b):a(c+"##"+b),$(this).closest(".entryTable").find("input[type='text']").val(""),$(this).prop("disabled",!0)}),$("#btnAddExcludeFilter").click(function(){var b=$("#txtUnblock").val().trim();/^\/.*\/$/.test(b)&&(b+="*"),a("@@"+b+"$document"),$(this).closest(".entryTable").find("input[type='text']").val(""),$(this).prop("disabled",!0)}),$("#btnAddBlacklist").click(function(){var c=b($("#txtBlacklist").val()),e=$("#txtFiltersAdvanced").val().trim()+"\n";e=e.replace(/^@@\*\$document,domain\=~.*\n/m,"").trim(),$("#txtFiltersAdvanced").val(e),c?a("@@*$document,domain="+c):d(),$("#btnAddBlacklist").prop("disabled",!0)}),$("#btnAddUrlBlock").click(function(){var b=$("#txtBlockUrl").val().trim(),c=$("#txtBlockUrlDomain").val().trim();"*"==c&&(c=""),/^\/.*\/$/.test(b)&&(b+="*"),""==c?a(b):a(b+"$domain="+c),$(this).closest(".entryTable").find("input[type='text']").val(""),$(this).prop("disabled",!0)}),$("#txtBlacklist").bind("input",function(){var a=b($("#txtBlacklist").val());a&&(a="@@*$document,domain="+a);var c="";$("#messageBlacklist").text(c),$("#messageBlacklist").hide();var d=parseFilter(a);return d.error?($("#btnAddBlacklist").prop("disabled",!0),c=translate("customfilterserrormessage",[$("#txtBlacklist").val(),d.error]),$("#messageBlacklist").text(c),void $("#messageBlacklist").show()):void $("#btnAddBlacklist").prop("disabled",!1)}),$("#divUrlBlock input[type='text']").bind("input",function(){var a=$("#txtBlockUrl").val().trim(),b=$("#txtBlockUrlDomain").val().trim();"*"==b&&(b=""),b&&(b="$domain="+b);var c=parseFilter(a+b);$("#btnAddUrlBlock").prop("disabled",!!c.error||null)}),$("#divCssBlock input[type='text']").bind("input",function(){var a=$("#txtUserFilterCss").val().trim(),b=$("#txtUserFilterDomain").val().trim();"*"==b&&(b="");var c=parseFilter(b+"##"+a);$("#btnAddUserFilter").prop("disabled",!!c.error||null)}),$("#divExcludeBlock input[type='text']").bind("input",function(){var a=$("#txtUnblock").val().trim(),b=parseFilter("@@"+a+"$document");(!a||isSelectorFilter(a))&&(b.error=!0),$("#btnAddExcludeFilter").prop("disabled",!!b.error||null)}),$(".entryTable input[type='text']").keypress(function(a){var b=$(this).closest(".entryTable").find("input[type='button']");13!==a.keyCode||b.prop("disabled")||(a.preventDefault(),b.click())}),$("a.controlsLink").click(function(){event.preventDefault();var a=$(this).closest("div").find(".addControls");$(".addControls").not(a).slideUp(),a.slideToggle()}),$("#btnEditAdvancedFilters").click(function(){$("#divAddNewFilter").slideUp(),$(".addControls").slideUp(),$("#txtFiltersAdvanced").prop("disabled",!1),$("#spanSaveButton").show(),$("#btnEditAdvancedFilters").hide(),$("#txtFiltersAdvanced").focus()}),$("#btnEditExcludeAdvancedFilters").click(function(){$("#divAddNewFilter").slideUp(),$(".addControls").slideUp(),$("#txtExcludeFiltersAdvanced").removeAttr("disabled"),$("#spanSaveExcludeButton").show(),$("#btnEditExcludeAdvancedFilters").hide(),$("#txtExcludeFiltersAdvanced").focus()}),$("#btnSaveAdvancedFilters").click(d),$("#btnSaveExcludeAdvancedFilters").click(function(){var a=$("#txtExcludeFiltersAdvanced").val();backgroundPage.ExcludeFilter.setExcludeFilters(a),$("#divAddNewFilter").slideDown(),$("#txtExcludeFiltersAdvanced").attr("disabled","disabled"),$("#spanSaveExcludeButton").hide(),$("#btnEditExcludeAdvancedFilters").show(),e()});var f=backgroundPage.getUserFilters();f&&f.length&&(originalCustomFilters=cleanCustomFilter(f),$("#txtFiltersAdvanced").val(originalCustomFilters.join("\n"))),optionalSettings&&optionalSettings.show_advanced_options&&!optionalSettings.safari_content_blocking&&$("#divExcludeFilters").show(),optionalSettings&&optionalSettings.safari_content_blocking&&$("#safariwarning").text(translate("contentblockingwarning")).show(),FilterNotifier.addListener(onFilterChange)});