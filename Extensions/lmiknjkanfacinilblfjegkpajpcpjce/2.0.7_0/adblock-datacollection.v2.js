DataCollectionV2=function(){"use strict";const{extractHostFromFrame:a}=require("url"),{RegExpFilter:b,WhitelistFilter:c,ElemHideFilter:d}=require("filterClasses");var e="timeLastPush",f={};f.filters={},f.domains={};var g=function(a,b,c){if(!chrome.runtime.lastError&&c&&c.url){let d=parseUri(c.url);"http:"!==d.protocol&&"https:"!==d.protocol||getSettings().data_collection_v2&&!adblockIsPaused()&&"loading"===b.status&&chrome.tabs.executeScript(a,{file:"adblock-datacollection-contentscript.js",allFrames:!0,runAt:"document_idle"},function(){chrome.runtime.lastError})}},h=function(){port.on("datacollection.elementHide",(b,c)=>{if(getSettings().data_collection_v2&&!adblockIsPaused()){var e=b.selectors,f=b.filters,g=a(c.frame);for(let a of FilterStorage.subscriptions)if(!a.disabled)for(let b of a.filters){let a=b instanceof d&&e.includes(b.selector)&&b.isActiveOnDomain(g);(a||f.includes(b.text))&&j(b,c.page)}}})},i=function(a){if(a.url&&"main_frame"===a.type&&!adblockIsPaused()){var b=parseUri(a.url).host;f.domains[b]||(f.domains[b]={},f.domains[b].pages=0),f.domains[b].pages++}},j=function(a,b){if(a&&a.text&&"string"==typeof a.text&&b&&b.url){var c=parseUri(b.url).host;if(!c)return;var d=a.text;d in f.filters||(f.filters[d]={},f.filters[d].firstParty={},f.filters[d].thirdParty={},f.filters[d].subscriptions=[]),a.thirdParty?(!f.filters[d].thirdParty[c]&&(f.filters[d].thirdParty[c]={},f.filters[d].thirdParty[c].hits=0),f.filters[d].thirdParty[c].hits++):(!f.filters[d].firstParty[c]&&(f.filters[d].firstParty[c]={},f.filters[d].firstParty[c].hits=0),f.filters[d].firstParty[c].hits++),a.subscriptions&&0<a.subscriptions.length&&a.subscriptions.forEach(function(a){a.url&&-1===f.filters[d].subscriptions.indexOf(a.url)&&f.filters[d].subscriptions.push(a.url)})}},k=function(a,b,c,d){getSettings().data_collection_v2&&!adblockIsPaused()?j(a,d):FilterNotifier.removeListener(k)};_settings.onload().then(function(){getSettings().data_collection_v2&&(window.setInterval(function(){idleHandler.scheduleItemOnce(function(){if(getSettings().data_collection_v2&&0<Object.keys(f.filters).length){var a=[],b=getAllSubscriptionsMinusText();for(var c in b)b[c].subscribed&&a.push(b[c].url);getUserFilters()&&a.push("customlist");var d={version:"4",addonName:require("info").addonName,addonVersion:require("info").addonVersion,application:require("info").application,applicationVersion:require("info").applicationVersion,platform:require("info").platform,platformVersion:require("info").platformVersion,appLocale:Utils.appLocale,filterListSubscriptions:a,domains:f.domains,filters:f.filters};ext.storage.get(e,function(a){var b="n/a";if(a[e]){var c=new Date(a[e]),g=c.getUTCFullYear()+"",h=c.getUTCMonth()+1+"",i=c.getUTCDate()+"",j=c.getUTCHours()+"",k=10*Math.floor(c.getUTCMinutes()/10)+"";1===h.length&&(h="0"+h),1===i.length&&(i="0"+i),1===j.length&&(j="0"+j),1===k.length&&(k="0"+k),"60"===k&&(k="00"),b=g+"-"+h+"-"+i+" "+j+":"+k+":00"}d.timeOfLastPush=b,postFilterStatsToLogServer(d,function(a,b,c){var d=new Date().toGMTString();if(c&&"function"==typeof c.getResponseHeader)try{c.getResponseHeader("Date")&&(d=c.getResponseHeader("Date"))}catch(a){d=new Date().toGMTString()}ext.storage.set(e,d),f={},f.filters={},f.domains={}})})}})},3600000),FilterNotifier.on("filter.hitCount",k),chrome.webRequest.onBeforeRequest.addListener(i,{urls:["http://*/*","https://*/*"],types:["main_frame"]}),chrome.tabs.onUpdated.addListener(g),h())});return{start:function(){f.filters={},f.domains={},FilterNotifier.on("filter.hitCount",k),chrome.webRequest.onBeforeRequest.addListener(i,{urls:["http://*/*","https://*/*"],types:["main_frame"]}),chrome.tabs.onUpdated.addListener(g),h()},end:function(){f={},FilterNotifier.off("filter.hitCount",k),chrome.webRequest.onBeforeRequest.removeListener(i),ext.storage.remove(e),chrome.tabs.onUpdated.removeListener(g)},getCache:function(){return f}}}();