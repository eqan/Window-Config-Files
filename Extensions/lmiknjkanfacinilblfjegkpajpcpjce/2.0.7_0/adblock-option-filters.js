function CheckboxForFilterList(a,b,c,d){this._container=d,this._filterList=a;var e=b+"_"+c;this._div=$("<div></div>").addClass("subscription").addClass(b).attr("name",a.id).css("display","language_filter_list"===b?a.subscribed?"block":"none":"block"),this._checkBox=$("<input />").attr("type","checkbox").attr("id",e).css("margin-left","2px").prop("checked",!!a.subscribed||null).addClass("filter_list_control"),this._label=$("<label></label>").text(a.label||a.title||a.url).attr("title",a.url).attr("for",e),this._link=$("<a></a>").text(a.label||a.title).css("margin-left","6px").css("font-size","10px").css("display",$("#btnShowLinks").prop("disabled")?"inline":"none").attr("target","_blank").attr("class","linkToList").attr("data-URL",a.url).click(function(){var a=$(this).attr("data-URL");$(this).attr("href",a)}),this._infospan=$("<span></span>").addClass("subscription_info").text(a.subscribed&&!a.lastDownload?translate("fetchinglabel"):""),this._removeFilterListLabel=a.user_submitted?$("<a>").css("font-size","10px").css("display",a.subscribed?"none":"inline").css("padding-left","10px").attr("href","#").addClass("remove_filterList").text(translate("removefromlist")).click(function(b){b.preventDefault();var c=$(this).parent(),d=c.attr("name");SubscriptionUtil.unsubscribe(d,a,!0),c.remove()}):null}CheckboxForFilterList.prototype={_bindActions:function(){this._checkBox.change(function(){var a=$(this).parent(),b=$(this).is(":checked"),c=a.attr("name");if(b){if(!SubscriptionUtil.validateOverSubscription())return void $(this).prop("checked",!1);$(".subscription_info",a).text(translate("fetchinglabel")),SubscriptionUtil.subscribe(c),FilterListUtil.cachedSubscriptions[c].subscribed=!0}else{if(!SubscriptionUtil.validateUnderSubscription())return void $(this).prop("checked",!0);SubscriptionUtil.unsubscribe(c,!1),$(".subscription_info",a).text(translate("unsubscribedlabel")),FilterListUtil.cachedSubscriptions[c].subscribed=!1,FilterListUtil.cachedSubscriptions[c].lastDownload=-1,FilterListUtil.cachedSubscriptions[c]._lastDownload=-1}if($(".remove_filterList",a).css("display",b?"none":"inline"),-1<a.attr("class").indexOf("language_filter_list")&&(a.toggle(500),!b)){var d=$(this),e=d.attr("id").split("_")[3],f=filterListSections.language_filter_list.array[e];f.hasOwnProperty("label")||(f.label=translateIDs(c));var g=new OptionForFilterList(f,e);LanguageSelectUtil.insertOption(g.get(),e)}}),this._filterList.user_submitted&&this._removeFilterListLabel.click(function(a){a.preventDefault();var b=$(this).parent(),c=b.attr("name");SubscriptionUtil.unsubscribe(c,b._filterList,!0),b.remove()})},createCheckbox:function(a){this._div.append(this._checkBox).append(this._label).append(this._link).append(this._infospan).append(this._removeFilterListLabel),this._container.append(this._div),this._bindActions(),a&&(this._checkBox.prop("checked",!0),this._checkBox.trigger("change"))}};function OptionForFilterList(a,b){this._option=$("<option>",{value:a.id,text:a.label||a.title,hidden:a.hidden}).data("index",b)}OptionForFilterList.prototype={get:function(){return this._option}};var filterListSections={adblock_filter_list:{array:[],$container:$("#ad_blocking_list")},language_filter_list:{array:[],$container:$("#language_list")},other_filter_list:{array:[],$container:$("#other_filter_lists")},custom_filter_list:{array:[],$container:$("#custom_filter_lists")}};function SectionHandler(a,b){this._cachedSubscriptions=a.array,this._$section=a.$container,this._filterList_type=b}SectionHandler.prototype={_organize:function(){for(var a=0;a<this._cachedSubscriptions.length;a++){var b=this._cachedSubscriptions[a],c=new CheckboxForFilterList(b,this._filterList_type,a,this._$section);c.createCheckbox()}},initSection:function(){this._organize()}};function FilterListUtil(){}FilterListUtil.sortFilterListArrays=function(){for(var a in filterListSections)filterListSections[a].array.sort(function(c,a){return c.label>a.label?1:c.label===a.label?0:-1})},FilterListUtil.getFilterListType=function(a){var b="";return b="adblock_custom"===a.id||"easylist"===a.id||"acceptable_ads"===a.id?"adblock_filter_list":"easyprivacy"===a.id||"antisocial"===a.id||"malware"===a.id||"annoyances"===a.id||"bitcoin_mining_protection"===a.id||"warning_removal"===a.id?"other_filter_list":!0===a.language?"language_filter_list":"custom_filter_list",b},FilterListUtil.prepareSubscriptions=function(a){for(var b in FilterListUtil.cachedSubscriptions=a,a)if(b){var c=a[b];c.label=translateIDs(b),c.id=b;var d=FilterListUtil.getFilterListType(c);filterListSections[d].array.push(c)}FilterListUtil.sortFilterListArrays()},FilterListUtil.checkUrlForExistingFilterList=function(a){var b=FilterListUtil.cachedSubscriptions;for(var c in b)if(a===b[c].url)return b[c]},FilterListUtil.updateSubscriptionInfoAll=function(){var a=FilterListUtil.cachedSubscriptions;for(var b in a)FilterListUtil.updateSubscriptionInfoForId(b)},FilterListUtil.updateSubscriptionInfoForId=function(a){var b=Math.round,c=$("[name='"+a+"']"),d=FilterListUtil.cachedSubscriptions[a];if(!1!==d.subscribed){var e=$(".subscription_info",c),f=e.text(),g=d.lastDownload||d._lastDownload;if(e.text()!==translate("invalidListUrl")){if(Synchronizer.isExecuting(d.url))f=translate("fetchinglabel");else if(d.downloadStatus&&"synchronize_ok"!=d.downloadStatus){var h={synchronize_invalid_url:translate("ab_filters_subscription_lastDownload_invalidURL"),synchronize_connection_error:translate("ab_filters_subscription_lastDownload_connectionError"),synchronize_invalid_data:translate("ab_filters_subscription_lastDownload_invalidData"),synchronize_checksum_mismatch:translate("ab_filters_subscription_lastDownload_checksumMismatch")};f=d.downloadStatus in h?h[d.downloadStatus]:d.downloadStatus}else if(0<g){var i=Date.now()-1e3*g,j=b(i/1e3),k=b(j/60),l=b(k/60),m=b(l/24),f="";f+=10>j?translate("updatedrightnow"):60>j?translate("updatedsecondsago",[j]):1===k?translate("updatedminuteago"):60>k?translate("updatedminutesago",[k]):1===l?translate("updatedhourago"):24>l?translate("updatedhoursago",[l]):1===m?translate("updateddayago"):translate("updateddaysago",[m])}e.text(f)}}},FilterListUtil.updateCheckbox=function(a,b){var c=$("div[name='"+b+"']"),d=$(c).find("input");d.is(":checked")!==a.subscribed&&(d.prop("checked",!!a.subscribed||null),$(".subscription_info",c).text(a.subscribed?translate("fetchinglabel"):translate("unsubscribedlabel")))};function LanguageSelectUtil(){}LanguageSelectUtil.insertOption=function(a,b){var c,d=$("#language_select"),e=d.find("option");for(c=0;c<e.length;c++){var f=e.eq(c).data("index");if(f&&parseInt(f)>parseInt(b))break}0<e.eq(c).length?e.eq(c).before(a):d.append(a)},LanguageSelectUtil.init=function(){for(var a,b=filterListSections.language_filter_list.array,c=0;c<b.length;c++)if(a=b[c],!a.subscribed){var d=new OptionForFilterList(a,c);LanguageSelectUtil.insertOption(d.get(),c)}$("#language_select").change(function(){var a=$(this),c=a.find(":selected"),d=$(c).data("index"),e=b[d];if(e){a.find("option:first").prop("selected",!0),c.remove();var f=$("[name='"+e.id+"']").find("input");f.prop("checked",!0),f.trigger("change")}})},LanguageSelectUtil.triggerChange=function(a){var b=$("#language_select");b.val(a.id),b.trigger("change")};function SubscriptionUtil(){}SubscriptionUtil.validateOverSubscription=function(){if(6>=$(".subscription :checked").length)return!0;if(optionalSettings&&optionalSettings.show_advanced_options){if($.cookie("noOversubscriptionWarning"))return!0;$.cookie("noOversubscriptionWarning","true",{expires:1/48})}return confirm(translate("you_know_thats_a_bad_idea_right"))},SubscriptionUtil.validateUnderSubscription=function(){if(1<=$(".subscription :checked").length)return!0;if(optionalSettings&&optionalSettings.show_advanced_options){if($.cookie("noUnderSubscriptionWarning"))return!0;$.cookie("noUnderSubscriptionWarning","true",{expires:1/48})}return confirm(translate("unsubscribe_from_all_confirmation"))},SubscriptionUtil.subscribe=function(a,b){SubscriptionUtil._updateCacheValue(a);var c=FilterListUtil.cachedSubscriptions[a];if(c)c=Subscription.fromURL(c.url);else if(/^url\:.*/.test(a)){var d={user_submitted:!0,initialUrl:a.substr(4),url:a.substr(4),title:b};FilterListUtil.cachedSubscriptions[a]=d,c=Subscription.fromURL(d.url)}FilterStorage.addSubscription(c),c instanceof DownloadableSubscription&&Synchronizer.execute(c),"acceptable_ads"===a&&($("#acceptable_ads_info").slideUp(),$("#acceptable_ads").prop("checked",!0),optionalSettings=backgroundPage.getSettings(),optionalSettings&&optionalSettings.safari_content_blocking&&backgroundPage.updateFilterLists()),"easylist"===a&&$("#easylist_info").slideUp()},SubscriptionUtil.unsubscribe=function(a){SubscriptionUtil._updateCacheValue(a);var b=FilterListUtil.cachedSubscriptions[a];b=Subscription.fromURL(b.url),setTimeout(function(){FilterStorage.removeSubscription(b)},1),"acceptable_ads"===a&&($("#acceptable_ads_info").slideDown(),$("#acceptable_ads").prop("checked",!1),optionalSettings=backgroundPage.getSettings(),optionalSettings&&optionalSettings.safari_content_blocking&&backgroundPage.updateFilterLists()),"easylist"===a&&$("#easylist_info").slideDown()},SubscriptionUtil._updateCacheValue=function(a){var b=FilterListUtil.cachedSubscriptions[a];if(b)for(var c=["downloadStatus","label","lastDownload","_downloadStatus"],d=0;d<c.length;d++)b[c[d]]&&delete b[c[d]]};function CustomFilterListUploadUtil(){}CustomFilterListUploadUtil._performUpload=function(a,b,c){var d={id:b,url:a,subscribed:!1,user_submitted:!0,label:"",title:c};FilterListUtil.cachedSubscriptions[d.id]=d;var e=filterListSections.custom_filter_list,f=new CheckboxForFilterList(d,"custom_filter_list",e.array.length,e.$container);f.createCheckbox(!0)},CustomFilterListUploadUtil._updateExistingFilterList=function(a){var b=$("div[name='"+a.id+"']");if(1>b.length){var c=FilterListUtil.getFilterListType(a),d=filterListSections[c].array,e=d.indexOf(a);0>e&&(e=d.length,d.push(a));var f=new CheckboxForFilterList(a,c,e,filterListSections[c].$container);f.createCheckbox(),b=$("div[name='"+a.id+"']")}var g=$(b).find("input");g.is(":checked")||(0<=g.attr("id").indexOf("language_filter_list")?LanguageSelectUtil.triggerChange(a):(g.prop("checked",!0),g.trigger("change")))},CustomFilterListUploadUtil.bindControls=function(){$("#btnNewSubscriptionUrl").click(function(){var a=$("#txtNewSubscriptionUrl").val(),b=/^abp.*\Wlocation=([^\&]+)/i;b.test(a)&&(a=a.match(b)[1],a=unescape(a)),a=a.trim();var c="url:"+a,d=FilterListUtil.checkUrlForExistingFilterList(a);d?CustomFilterListUploadUtil._updateExistingFilterList(d):/^https?\:\/\/[^\<]+$/.test(a)?CustomFilterListUploadUtil._performUpload(a,c):alert(translate("failedtofetchfilter")),$("#txtNewSubscriptionTitle").hide(),$("#txtNewSubscriptionUrl").val("")}),$("#txtNewSubscriptionUrl").keypress(function(a){13===a.keyCode&&(a.preventDefault(),$("#btnNewSubscriptionUrl").click())})};function onFilterChangeHandler(a,b,c,d){var e=function(a,b){if(a){for(var c=["downloadStatus","label","lastDownload","_downloadStatus","language"],d=0;d<c.length;d++)a[c[d]]&&(FilterListUtil.cachedSubscriptions[a.id][c[d]]=a[c[d]]);b&&"subscription.added"===b&&(FilterListUtil.cachedSubscriptions[a.id].subscribed=!0),b&&"subscription.removed"===b&&(FilterListUtil.cachedSubscriptions[a.id].subscribed=!1),FilterListUtil.updateCheckbox(FilterListUtil.cachedSubscriptions[a.id],a.id),FilterListUtil.cachedSubscriptions[a.id].subscribed&&FilterListUtil.updateSubscriptionInfoForId(a.id)}};if(a&&("load"===a||-1<a.indexOf("subscription."))){if(b&&b.url){var f=function(b,c){b.id=c,e(b,a)},g=backgroundPage.getIdFromURL(b.url);if(g)return void f(b,g);if(FilterListUtil.cachedSubscriptions["url:"+b.url])return void f(b,"url:"+b.url);if("subscription.title"===a&&c){var g=backgroundPage.getIdFromURL(c);if(g)return void f(b,g);var g=backgroundPage.getIdFromURL(d);if(g)return void f(b,g)}}var h=backgroundPage.getAllSubscriptionsMinusText(),i=FilterListUtil.cachedSubscriptions;for(var g in i){var j=h[g];e(j)}}}function translateIDs(a){if(a.endsWith("_old")){var b=a.split(/_old$/)[0];return translate("filter"+b)}var c=translate("filter_"+a);return c=c.trim(),""!=c&&0<c.length?c:translate("filter"+a)}$(function(){var a=backgroundPage.getAllSubscriptionsMinusText();for(var b in FilterListUtil.prepareSubscriptions(a),filterListSections){var c=new SectionHandler(filterListSections[b],b);c.initSection()}LanguageSelectUtil.init(),CustomFilterListUploadUtil.bindControls(),FilterNotifier.addListener(onFilterChangeHandler),FilterListUtil.updateSubscriptionInfoAll(),window.setInterval(function(){FilterListUtil.updateSubscriptionInfoAll()},1e4),$("#btnUpdateNow").click(function(){$(this).prop("disabled",!0),backgroundPage.updateFilterLists(),setTimeout(function(){$("#btnUpdateNow").prop("disabled",!1)},3e5)}),$("#btnShowLinks").click(function(){$(".linkToList").fadeIn("slow"),$("#btnShowLinks").remove()}),delayedSubscriptionSelection&&startSubscriptionSelection.apply(null,delayedSubscriptionSelection)});