"use strict";let lastFilterQuery=null;function generateFilter(a,b){let c=a.url.replace(/^[\w-]+:\/+(?:www\.)?/,"||"),d=[];return"POPUP"==a.type&&(d.push("popup"),"about:blank"==a.url&&(b=!0)),b&&d.push("domain="+a.docDomain),0<d.length&&(c+="$"+d.join(",")),c}function createActionButton(a,b,c){let d=document.createElement("span");return d.textContent=b,d.classList.add("action"),d.addEventListener("click",()=>{ext.backgroundPage.sendMessage({type:"filters."+a,text:c})},!1),d}function createRecord(a,b,c){let d=document.importNode(c,!0);d.dataset.type=a.type,d.querySelector(".domain").textContent=a.docDomain,d.querySelector(".type").textContent=a.type;let e=d.querySelector(".url"),f=d.querySelector(".action-wrapper");if(a.url&&(e.textContent=a.url,"POPUP"!=a.type&&(e.classList.add("resourceLink"),e.addEventListener("click",()=>{ext.devtools.panels.openResource(a.url)},!1))),b){let c=d.querySelector(".filter"),e=d.querySelector(".origin");c.textContent=b.text,d.dataset.state=b.whitelisted?"whitelisted":"blocked",b.subscription?e.textContent=b.subscription:(e.textContent=b.userDefined?"user-defined":"unnamed subscription",e.classList.add("unnamed")),b.whitelisted||"ELEMHIDE"==a.type||f.appendChild(createActionButton("add","Add exception","@@"+generateFilter(a,!1))),b.userDefined&&f.appendChild(createActionButton("remove","Remove rule",b.text))}else f.appendChild(createActionButton("add","Block item",generateFilter(a,a.specificOnly)));return lastFilterQuery&&shouldFilterRow(d,lastFilterQuery)&&d.classList.add("filtered-by-search"),d}function shouldFilterRow(a,b){let c=[a.getElementsByClassName("url"),a.getElementsByClassName("filter"),a.getElementsByClassName("origin"),a.getElementsByClassName("type")];for(let d of c)for(let a of d)if(-1!=a.innerText.search(b))return!1;return!0}function performSearch(a,b){for(let c of a.rows)shouldFilterRow(c,b)?c.classList.add("filtered-by-search"):c.classList.remove("filtered-by-search")}function cancelSearch(a){for(let b of a.rows)b.classList.remove("filtered-by-search")}document.addEventListener("DOMContentLoaded",()=>{let a=document.getElementById("items"),b=a.querySelector("tbody"),c=document.querySelector("template").content.firstElementChild;document.getElementById("reload").addEventListener("click",()=>{ext.devtools.inspectedWindow.reload()},!1),document.getElementById("filter-state").addEventListener("change",b=>{a.dataset.filterState=b.target.value},!1),document.getElementById("filter-type").addEventListener("change",b=>{a.dataset.filterType=b.target.value},!1),ext.onMessage.addListener(d=>{switch(d.type){case"add-record":b.appendChild(createRecord(d.request,d.filter,c));break;case"update-record":let e=b.getElementsByTagName("tr")[d.index],f=createRecord(d.request,d.filter,c);e.parentNode.replaceChild(f,e),f.classList.add("changed"),a.classList.add("has-changes");break;case"remove-record":let g=b.getElementsByTagName("tr")[d.index];g.parentNode.removeChild(g),a.classList.add("has-changes");break;case"reset":b.innerHTML="",a.classList.remove("has-changes");}}),window.addEventListener("message",a=>{switch(a.data.type){case"performSearch":performSearch(b,a.data.queryString),lastFilterQuery=a.data.queryString;break;case"cancelSearch":cancelSearch(b),lastFilterQuery=null;}});let d=chrome.devtools.panels.themeName||"default";document.body.classList.add(d)},!1);