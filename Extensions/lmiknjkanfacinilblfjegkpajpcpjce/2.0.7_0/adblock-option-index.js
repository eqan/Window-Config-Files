var SAFARI=!1,backgroundPage=ext.backgroundPage.getWindow(),require=backgroundPage.require;with(require("filterClasses"))this.Filter=Filter,this.WhitelistFilter=WhitelistFilter;with(require("subscriptionClasses"))this.Subscription=Subscription,this.SpecialSubscription=SpecialSubscription,this.DownloadableSubscription=DownloadableSubscription;with(require("filterValidation"))this.parseFilter=parseFilter,this.parseFilters=parseFilters;var FilterStorage=require("filterStorage").FilterStorage,FilterNotifier=require("filterNotifier").FilterNotifier,Prefs=require("prefs").Prefs,Synchronizer=require("synchronizer").Synchronizer,Utils=require("utils").Utils,NotificationStorage=require("notification").Notification;function loadOptions(){backgroundPage&&"function"!=typeof backgroundPage.getSettings&&window.setTimeout(function(){window.location.reload()},50),backgroundPage&&"function"==typeof backgroundPage.getSettings&&(optionalSettings=backgroundPage.getSettings());var a=$.cookie("activetab");if(window.location&&window.location.search){var b=parseUri.parseSearch(window.location.search);b&&b.tab&&(a=b.tab)}backgroundPage.recordGeneralMessage("options_opened",void 0,{tab:a}),$("#tabpages").tabs({active:a,activate:function(a,b){$.cookie("activetab",b.newTab.index(),{expires:10})},beforeLoad:function(a,b){var c=b.tab.index();return b.tab.data("loaded")&&3!==c?void a.preventDefault():void b.jqXHR.success(function(){b.tab.data("loaded",!0)})},load:function(a,b){localizePage(),optionalSettings&&!optionalSettings.show_advanced_options&&$(".advanced").hide(),SAFARI&&$(".chrome-only").hide(),$(".safari-only").hide(),b.tab[0].dataset.scripts.split(" ").forEach(function(a){var b=document.createElement("script");b.src=a,document.body.appendChild(b)})}}).show()}var language=navigator.language.match(/^[a-z]+/i)[0];function rightToLeft(){"ar"===language||"he"===language?($(window).resize(function(){$(".social").is(":hidden")?($("#translation_credits").css({margin:"0px 50%",width:"350px"}),$("#paymentlink").css({margin:"0px 50%",width:"350px"}),$("#version_number").css({margin:"20px 50%",width:"350px"})):($("#translation_credits").css("right","0px"),$("#paymentlink").css("right","0px"),$("#version_number").css({right:"0px",padding:"0px"}))}),$("li").css("float","right"),$("#small_nav").css({right:"initial",left:"45px"}),$(".ui-tabs .ui-tabs-nav li").css("float","right")):$(".ui-tabs .ui-tabs-nav li").css("float","left")}function showMiniMenu(){$("#small_nav").click(function(){$(".ui-tabs-nav").is(":hidden")?($(".ui-tabs .ui-tabs-nav li").css("float","none"),$(".ui-tabs-nav").fadeIn("fast"),("ar"===language||"he"===language)&&$(".ui-tabs-nav").css({right:"auto",left:"40px"})):$(".ui-tabs-nav").fadeOut("fast")}),$(window).resize(function(){$(".ui-tabs-nav").is(":hidden")&&$("#small_nav").is(":hidden")?("ar"===language||"he"===language?($(".ui-tabs .ui-tabs-nav li").css("float","right"),$(".ui-tabs-nav").css({right:"auto",left:"auto"})):$(".ui-tabs .ui-tabs-nav li").css("float","left"),$(".ui-tabs-nav").show()):$("#small_nav").is(":visible")&&$(".ui-tabs-nav").hide()})}function displayVersionNumber(){try{var a=new XMLHttpRequest;a.open("GET",chrome.extension.getURL("manifest.json"),!0),a.onreadystatechange=function(){if(4==this.readyState){var a=JSON.parse(this.responseText);$("#version_number").text(translate("optionsversion",[a.version]))}},a.send()}catch(a){}}backgroundPage.ext.storage.get("userid",function(a){a.userid});function displayTranslationCredit(){if("en"!=navigator.language.substring(0,2)){var a=[],b=new XMLHttpRequest;b.open("GET",chrome.extension.getURL("translators.json"),!0),b.onload=function(){var b=JSON.parse(this.responseText),c=navigator.language;for(var d in b){if(d===c)for(var e in b[d].translators){var f=b[d].translators[e].credit;a.push(" "+f)}else for(var e in b[d].translators){var c=c.toLowerCase();if(d===c){var f=b[c].translators[e].credit;a.push(" "+f)}}var e,f,e,f}$("#translator_credit").text(translate("translator_credit")),$("#translator_names").text(a.toString())},b.send()}}var isSelectorFilter=function(a){return /\#\@?\#./.test(a)},isSelectorExcludeFilter=function(a){return /\#\@\#./.test(a)},isWhitelistFilter=function(a){return /^\@\@/.test(a)},optionalSettings={};$(document).ready(function(){loadOptions(),rightToLeft(),showMiniMenu(),displayVersionNumber(),displayTranslationCredit(),localizePage()});var delayedSubscriptionSelection=null;function startSubscriptionSelection(a,b){var c=document.getElementById("language_select");if(!c||"undefined"==typeof FilterListUtil||null===FilterListUtil||"undefined"==typeof CustomFilterListUploadUtil||null===CustomFilterListUploadUtil)return $("#tabpages").tabs("option","active",1),void(delayedSubscriptionSelection=[a,b]);var d=translate("subscribeconfirm",a);if(window.confirm(d)){var e=FilterListUtil.checkUrlForExistingFilterList(b);e?CustomFilterListUploadUtil._updateExistingFilterList(e):/^https?\:\/\/[^\<]+$/.test(b)?CustomFilterListUploadUtil._performUpload(b,"url:"+b,a):alert(translate("failedtofetchfilter"))}}function onMessage(a){if(("app.listen"===a.type||"app.respond"===a.type)&&"addSubscription"===a.action&&a.args&&0<a.args.length){var b=a.args[0];startSubscriptionSelection(b.title,b.url)}}ext.onMessage.addListener(onMessage),ext.backgroundPage.sendMessage({type:"app.listen",filter:["addSubscription"]});